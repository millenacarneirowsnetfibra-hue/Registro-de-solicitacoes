<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniformControl | Gestão de Uniformes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- Biblioteca para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Biblioteca para exportação -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --primary: #4A6FA5;
            --primary-light: #6B8CC6;
            --primary-extra-light: #E8EFF7;
            --secondary: #7E8D85;
            --accent: #FF7E5F;
            --accent-light: #FFEEE9;
            --light: #F8F9FA;
            --lighter: #FFFFFF;
            --border: #E9ECEF;
            --text: #2D3748;
            --text-light: #718096;
            --text-lighter: #A0AEC0;
            --success: #38A169;
            --warning: #D69E2E;
            --danger: #E53E3E;
            --info: #4299E1;
            --shadow: rgba(0, 0, 0, 0.05);
            --shadow-hover: rgba(0, 0, 0, 0.08);
            --sidebar-width: 280px;
            --header-height: 75px;
            --border-radius: 14px;
            --transition: all 0.3s ease;
        }

        body {
            background-color: #F5F7FB;
            color: var(--text);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar - Design Moderno e Limpo */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--lighter);
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: var(--transition);
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.03);
            border-right: 1px solid rgba(0, 0, 0, 0.03);
            left: 0;
            top: 0;
        }

        .sidebar-header {
            padding: 28px 24px;
            display: flex;
            align-items: center;
            gap: 14px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            width: 46px;
            height: 46px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 4px 12px rgba(74, 111, 165, 0.2);
        }

        .app-name h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
            letter-spacing: -0.3px;
        }

        .app-name p {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .sidebar-nav {
            padding: 24px 20px;
            flex-grow: 1;
        }

        .nav-title {
            font-size: 0.82rem;
            color: var(--text-lighter);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
            margin-bottom: 18px;
            padding-left: 12px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            text-decoration: none;
            color: var(--text);
            border-radius: 12px;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
        }

        .nav-link:hover {
            background-color: var(--primary-extra-light);
            color: var(--primary);
        }

        .nav-link.active {
            background-color: var(--primary-extra-light);
            color: var(--primary);
            font-weight: 600;
        }

        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--primary);
            border-radius: 0 2px 2px 0;
        }

        .nav-link i {
            width: 24px;
            font-size: 1.15rem;
            margin-right: 14px;
        }

        .sidebar-footer {
            padding: 24px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 14px;
            background-color: #FCFDFE;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 4px 8px rgba(74, 111, 165, 0.15);
        }

        .user-info h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text);
        }

        .user-info p {
            font-size: 0.78rem;
            color: var(--text-light);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            width: calc(100% - var(--sidebar-width));
        }

        .main-header {
            height: var(--header-height);
            background-color: var(--lighter);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.95);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text);
            transition: var(--transition);
            background-color: #F5F7FB;
        }

        .menu-toggle:hover {
            background-color: var(--primary-extra-light);
            color: var(--primary);
        }

        .page-title h1 {
            font-size: 1.7rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .notification {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: #F5F7FB;
        }

        .notification:hover {
            background-color: var(--primary-extra-light);
            color: var(--primary);
        }

        .notification-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 9px;
            height: 9px;
            background-color: var(--accent);
            border-radius: 50%;
            border: 2px solid white;
        }

        .current-time {
            font-size: 0.95rem;
            color: var(--text-light);
            font-weight: 500;
            padding: 8px 16px;
            background-color: #F5F7FB;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .current-time i {
            color: var(--primary);
        }

        /* Content Area - Página Atual */
        .content-wrapper {
            flex: 1;
            padding: 32px;
            display: none;
        }

        .content-wrapper.active {
            display: block;
        }

        /* Dashboard Content */
        .dashboard-content .content-header {
            margin-bottom: 32px;
        }

        .dashboard-content .header-info h2 {
            font-size: 1.9rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .dashboard-content .header-info p {
            color: var(--text-light);
            font-size: 1.05rem;
            max-width: 650px;
            line-height: 1.5;
        }

        /* Dashboard Filters */
        .dashboard-filters {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
        }

        .dashboard-filters-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dashboard-filters-title i {
            color: var(--primary);
        }

        .dashboard-filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Cards Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
        }

        .stat-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .stat-icon.colaboradores {
            background-color: rgba(255, 126, 95, 0.1);
            color: var(--accent);
        }

        .stat-icon.solicitacoes {
            background-color: rgba(214, 158, 46, 0.1);
            color: var(--warning);
        }

        .stat-icon.tempo-medio {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .stat-icon.dashboard {
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .stat-detail {
            font-size: 0.85rem;
            color: var(--text-lighter);
            margin-top: 5px;
        }

        /* Filtro para tempo médio */
        .tempo-medio-filter {
            margin-top: 10px;
            padding: 8px 12px;
            background-color: var(--primary-extra-light);
            border-radius: 8px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tempo-medio-filter select {
            background: none;
            border: none;
            font-size: 0.9rem;
            color: var(--text);
            outline: none;
            cursor: pointer;
            flex: 1;
        }

        /* Gráficos Dashboard */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .chart-card {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            position: relative;
        }

        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title i {
            color: var(--primary);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Atividades Recentes */
        .recent-activity {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            position: relative;
        }

        .recent-activity::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary);
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            background-color: var(--primary-extra-light);
            color: var(--primary);
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-weight: 500;
            color: var(--text);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Estilos específicos para as abas */
        .empresa-content .content-header,
        .colaboradores-content .content-header,
        .itens-content .content-header,
        .solicitacoes-content .content-header,
        .relatorios-content .content-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .empresa-content .header-info h2,
        .colaboradores-content .header-info h2,
        .itens-content .header-info h2,
        .solicitacoes-content .header-info h2,
        .relatorios-content .header-info h2 {
            font-size: 1.9rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .empresa-content .header-info p,
        .colaboradores-content .header-info p,
        .itens-content .header-info p,
        .solicitacoes-content .header-info p,
        .relatorios-content .header-info p {
            color: var(--text-light);
            font-size: 1.05rem;
            max-width: 650px;
            line-height: 1.5;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-light);
            box-shadow: 0 6px 12px rgba(74, 111, 165, 0.2);
        }

        .btn-secondary {
            background-color: var(--lighter);
            color: var(--primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background-color: var(--primary-extra-light);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #2F855A;
            box-shadow: 0 6px 12px rgba(56, 161, 105, 0.2);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #C53030;
            box-shadow: 0 6px 12px rgba(229, 62, 62, 0.2);
        }

        .btn-info {
            background-color: var(--primary);
            color: white;
        }

        .btn-info:hover {
            background-color: var(--primary-light);
        }

        /* Filtros */
        .filters-section {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
        }

        .filters-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters-title i {
            color: var(--primary);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .filter-input, .filter-select {
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: #FCFDFE;
            font-size: 0.95rem;
            color: var(--text);
            transition: var(--transition);
            height: 46px;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }

        /* Tabelas */
        .data-section {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            margin-bottom: 24px;
            position: relative;
        }

        .data-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .data-table thead {
            background-color: var(--primary-extra-light);
        }

        .data-table th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tbody tr {
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .data-table tbody tr:hover {
            background-color: #FCFDFE;
        }

        .data-table td {
            padding: 16px 20px;
            color: var(--text);
            font-size: 0.95rem;
            vertical-align: middle;
        }

        /* Badge para quantidade de solicitações */
        .solicitacoes-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            height: 32px;
            padding: 0 10px;
            background-color: var(--primary);
            color: white;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .solicitacoes-badge.zero {
            background-color: var(--text-lighter);
        }

        .solicitacoes-badge.baixa {
            background-color: var(--success);
        }

        .solicitacoes-badge.media {
            background-color: var(--warning);
        }

        .solicitacoes-badge.alta {
            background-color: var(--accent);
        }

        /* Badge para categoria */
        .categoria-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .categoria-badge.uniforme {
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary);
        }

        .categoria-badge.epi {
            background-color: rgba(255, 126, 95, 0.1);
            color: var(--accent);
        }

        .categoria-badge.material {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        /* Status badge para colaboradores */
        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-badge.ativo {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .status-badge.inativo {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--danger);
        }

        /* Status badge para solicitações */
        .status-solicitacao-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .status-solicitacao-badge.pendente {
            background-color: rgba(214, 158, 46, 0.1);
            color: var(--warning);
        }

        .status-solicitacao-badge.realizado {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .status-solicitacao-badge.nao-precisa {
            background-color: rgba(160, 174, 192, 0.1);
            color: var(--text-lighter);
        }

        /* Estilo para célula de solicitações */
        .solicitacoes-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .solicitacoes-info {
            font-size: 0.85rem;
            color: var(--text-light);
            white-space: nowrap;
        }

        /* Tags de tamanhos */
        .tamanhos-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tamanho-tag {
            display: inline-block;
            padding: 4px 10px;
            background-color: var(--primary-extra-light);
            color: var(--primary);
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Estilo para itens no histórico */
        .itens-lista {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .item-historico {
            font-size: 0.85rem;
            color: var(--text);
            padding: 2px 0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--border);
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--text-light);
        }

        .empty-state p {
            max-width: 400px;
            margin: 0 auto;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-light);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background-color: var(--border);
            color: var(--text);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
            font-size: 1rem;
            color: var(--text);
            background-color: #FCFDFE;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 6px;
            font-style: italic;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .btn-cancel {
            background-color: var(--lighter);
            color: var(--text-light);
            border: 1px solid var(--border);
        }

        .btn-cancel:hover {
            background-color: #F5F7FB;
        }

        .btn-save {
            flex: 1;
            background-color: var(--primary);
            color: white;
        }

        .btn-save:hover {
            background-color: var(--primary-light);
        }

        /* Ações na tabela */
        .actions-cell {
            display: flex;
            gap: 6px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: transparent;
            color: var(--text-light);
        }

        .action-btn:hover {
            background-color: var(--primary-extra-light);
            color: var(--primary);
        }

        /* Botões de status na tabela de solicitações */
        .status-actions {
            display: flex;
            gap: 4px;
        }

        .status-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .status-btn.pendente {
            background-color: rgba(214, 158, 46, 0.1);
            color: var(--warning);
        }

        .status-btn.pendente:hover {
            background-color: rgba(214, 158, 46, 0.2);
        }

        .status-btn.realizado {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .status-btn.realizado:hover {
            background-color: rgba(56, 161, 105, 0.2);
        }

        .status-btn.nao-precisa {
            background-color: rgba(160, 174, 192, 0.1);
            color: var(--text-lighter);
        }

        .status-btn.nao-precisa:hover {
            background-color: rgba(160, 174, 192, 0.2);
        }

        /* Grid para formulários */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-grid .full-width {
            grid-column: 1 / -1;
        }

        /* Estilos SIMPLIFICADOS para a aba de solicitações */
        .itens-solicitacao-container {
            background-color: var(--primary-extra-light);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--primary-light);
        }

        .item-solicitacao {
            background-color: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }

        .item-solicitacao:last-child {
            margin-bottom: 0;
        }

        .item-row {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .item-field {
            flex: 1;
            min-width: 0;
        }

        .item-field label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text);
        }

        .remover-item-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .add-item-btn {
            width: 100%;
            padding: 12px;
            background-color: rgba(74, 111, 165, 0.1);
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
        }

        .add-item-btn:hover {
            background-color: rgba(74, 111, 165, 0.2);
        }

        .data-solicitacao-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .data-solicitacao-group .form-group {
            flex: 1;
        }

        /* Estilos para relatórios */
        .relatorios-content .page-content {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 48px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.03);
            min-height: 520px;
            text-align: left;
            position: relative;
            display: block;
        }

        .relatorios-content .page-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .relatorios-content .page-icon {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(74, 111, 165, 0.08), rgba(107, 140, 198, 0.08));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 28px;
            color: var(--primary);
            font-size: 2.8rem;
            border: 1px solid rgba(74, 111, 165, 0.1);
        }

        .relatorios-content .page-content h3 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 18px;
            text-align: left;
        }

        .relatorios-content .page-content p {
            color: var(--text-light);
            font-size: 1.15rem;
            line-height: 1.6;
            margin-bottom: 32px;
            text-align: left;
        }

        /* Opções de relatórios */
        .report-options-section {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            position: relative;
        }

        .report-options-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .report-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .report-option-card {
            background-color: #FCFDFE;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .report-option-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(74, 111, 165, 0.1);
        }

        .report-option-card.selected {
            border-color: var(--primary);
            background-color: var(--primary-extra-light);
        }

        .report-option-checkbox {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 22px;
            height: 22px;
            border-radius: 6px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
        }

        .report-option-card.selected .report-option-checkbox {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .report-option-card.selected .report-option-checkbox::after {
            content: '✓';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .report-option-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: white;
            font-size: 1.8rem;
        }

        .report-option-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 10px;
        }

        .report-option-description {
            font-size: 0.95rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        /* Filtros avançados para relatórios */
        .report-filters-section {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            position: relative;
        }

        .report-filters-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .report-filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .report-action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            justify-content: flex-end;
        }

        /* Botões de exportação */
        .export-btn {
            padding: 14px 28px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            min-width: 180px;
        }

        .export-btn.pdf {
            background-color: #E53E3E;
            color: white;
        }

        .export-btn.pdf:hover {
            background-color: #C53030;
            box-shadow: 0 6px 12px rgba(229, 62, 62, 0.2);
        }

        .export-btn.excel {
            background-color: #38A169;
            color: white;
        }

        .export-btn.excel:hover {
            background-color: #2F855A;
            box-shadow: 0 6px 12px rgba(56, 161, 105, 0.2);
        }

        /* Visualização do relatório */
        .report-preview-section {
            background-color: var(--lighter);
            border-radius: var(--border-radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--border);
            position: relative;
            display: none;
        }

        .report-preview-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .report-preview-section.active {
            display: block;
        }

        .report-preview-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-preview-title i {
            color: var(--primary);
        }

        .report-preview-content {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            background-color: #FCFDFE;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
        }

        .preview-table th {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 2px solid var(--border);
            background-color: var(--primary-extra-light);
        }

        .preview-table td {
            padding: 12px 16px;
            color: var(--text);
            border-bottom: 1px solid var(--border);
        }

        .preview-table tr:hover {
            background-color: #F5F7FB;
        }

        /* Footer */
        .main-footer {
            padding: 22px 32px;
            border-top: 1px solid var(--border);
            background-color: var(--lighter);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-info p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            gap: 24px;
        }

        .footer-links a {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        /* Overlay para mobile */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 99;
            display: none;
            transition: var(--transition);
        }

        /* Responsividade */
        @media (max-width: 1100px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .menu-toggle {
                display: flex !important;
            }

            .sidebar-overlay.active {
                display: block;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 24px;
            }

            .main-header {
                padding: 0 24px;
            }

            .empresa-content .content-header,
            .colaboradores-content .content-header,
            .itens-content .content-header,
            .solicitacoes-content .content-header,
            .relatorios-content .content-header {
                flex-direction: column;
                gap: 20px;
            }

            .action-buttons {
                width: 100%;
                justify-content: flex-start;
            }

            .btn {
                flex: 1;
                justify-content: center;
            }

            .data-section {
                padding: 24px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-filters-grid {
                grid-template-columns: 1fr;
            }

            .page-content {
                padding: 36px 24px;
            }

            .page-icon {
                width: 90px;
                height: 90px;
                font-size: 2.2rem;
            }

            .page-content h3 {
                font-size: 1.8rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .solicitacoes-cell {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
            
            .modal {
                width: 95%;
                padding: 24px;
                max-width: 95%;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .data-solicitacao-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .item-row {
                flex-direction: column;
                gap: 8px;
            }
            
            .remover-item-btn {
                width: 100%;
                height: 40px;
            }
            
            /* Responsividade para relatórios */
            .report-options-grid {
                grid-template-columns: 1fr;
            }
            
            .report-filters-grid {
                grid-template-columns: 1fr;
            }
            
            .report-action-buttons {
                flex-direction: column;
            }
            
            .export-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .main-footer {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .header-right {
                gap: 12px;
            }
            
            .current-time span {
                display: none;
            }
            
            .modal {
                width: 95%;
                padding: 20px;
            }
            
            .solicitacoes-badge {
                min-width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
            
            .solicitacoes-info {
                font-size: 0.8rem;
            }
            
            .actions-cell {
                flex-wrap: wrap;
            }
            
            .status-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-tshirt"></i>
            </div>
            <div class="app-name">
                <h2>UniformControl</h2>
                <p>Gestão de Uniformes</p>
            </div>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-title">Menu Principal</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="fas fa-chart-pie"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="empresa">
                        <i class="fas fa-building"></i>
                        <span>Empresa</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="colaboradores">
                        <i class="fas fa-users"></i>
                        <span>Colaboradores</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="itens">
                        <i class="fas fa-tshirt"></i>
                        <span>Itens</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="solicitacoes">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Solicitações</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="relatorios">
                        <i class="fas fa-chart-bar"></i>
                        <span>Relatórios</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="sidebar-footer">
            <div class="user-avatar">AD</div>
            <div class="user-info">
                <h4>Administrador</h4>
                <p>admin@empresa.com</p>
            </div>
        </div>
    </nav>

    <!-- Overlay for mobile -->
    <div class="sidebar-overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <header class="main-header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="page-title">
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
            </div>
            
            <div class="header-right">
                <!-- Notificação e hora removidos conforme solicitado -->
            </div>
        </header>

        <!-- Conteúdo Dashboard -->
        <div class="content-wrapper dashboard-content active" id="dashboardContent">
            <div class="content-header">
                <div class="header-info">
                    <h2>Dashboard</h2>
                    <p>Visão geral e principais métricas do sistema</p>
                </div>
            </div>

            <!-- Filtros do Dashboard -->
            <div class="dashboard-filters">
                <div class="dashboard-filters-title">
                    <i class="fas fa-filter"></i>
                    Filtros do Dashboard
                </div>
                
                <div class="dashboard-filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Período Inicial</label>
                        <input type="date" class="filter-input" id="dashboardDataInicio" value="">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Período Final</label>
                        <input type="date" class="filter-input" id="dashboardDataFim" value="">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Empresa</label>
                        <select class="filter-select" id="dashboardEmpresa">
                            <option value="">Todas as Empresas</option>
                            <!-- Empresas serão carregadas dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Departamento</label>
                        <select class="filter-select" id="dashboardDepartamento">
                            <option value="">Todos os Departamentos</option>
                            <!-- Departamentos serão carregados dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Item</label>
                        <select class="filter-select" id="dashboardItem">
                            <option value="">Todos os Itens</option>
                            <!-- Itens serão carregados dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-primary" id="btnAplicarFiltrosDashboard">
                            <i class="fas fa-check"></i>
                            Aplicar Filtros
                        </button>
                    </div>
                </div>
            </div>

            <!-- Estatísticas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon colaboradores">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="totalColaboradores">0</div>
                    <div class="stat-label">Total Colaboradores</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon solicitacoes">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="stat-value" id="totalSolicitacoes">0</div>
                    <div class="stat-label">Solicitações</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon tempo-medio">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-value" id="tempoMedioTroca">0</div>
                    <div class="stat-label">Tempo Médio de Troca</div>
                    <div class="tempo-medio-filter">
                        <i class="fas fa-calendar-alt"></i>
                        <select id="tempoMedioFiltro">
                            <option value="dias">Dias</option>
                            <option value="meses">Meses</option>
                            <option value="anos">Anos</option>
                        </select>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon dashboard">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="dashboardMetrica">0</div>
                    <div class="stat-label">Solicitações Pendentes</div>
                    <div class="stat-detail" id="dashboardDetalhe">De solicitações totais</div>
                </div>
            </div>

            <!-- Gráficos Dashboard -->
            <div class="charts-grid">
                <!-- Top 5 Itens Mais Solicitados -->
                <div class="chart-card">
                    <div class="chart-title">
                        <i class="fas fa-chart-bar"></i>
                        Top 5 Itens Mais Solicitados
                    </div>
                    <div class="chart-container">
                        <canvas id="chartItensMaisSolicitados"></canvas>
                    </div>
                </div>
                
                <!-- Top 5 Departamentos que Mais Solicitam -->
                <div class="chart-card">
                    <div class="chart-title">
                        <i class="fas fa-chart-pie"></i>
                        Top 5 Departamentos que Mais Solicitam
                    </div>
                    <div class="chart-container">
                        <canvas id="chartDepartamentosMaisSolicitacoes"></canvas>
                    </div>
                </div>
                
                <!-- Top 5 Colaboradores que Mais Solicitam -->
                <div class="chart-card">
                    <div class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        Top 5 Colaboradores que Mais Solicitam
                    </div>
                    <div class="chart-container">
                        <canvas id="chartColaboradoresMaisSolicitacoes"></canvas>
                    </div>
                </div>
                
                <!-- Distribuição por Status -->
                <div class="chart-card">
                    <div class="chart-title">
                        <i class="fas fa-chart-pie"></i>
                        Distribuição por Status
                    </div>
                    <div class="chart-container">
                        <canvas id="chartDistribuicaoStatus"></canvas>
                    </div>
                </div>
            </div>

            <!-- Atividades Recentes -->
            <div class="recent-activity">
                <div class="section-title">
                    <i class="fas fa-history"></i>
                    Atividades Recentes
                </div>
                
                <ul class="activity-list" id="activityList">
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Bem-vindo ao UniformControl!</div>
                            <div class="activity-time">Agora mesmo</div>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Footer removido conforme solicitado -->
        </div>

        <!-- Conteúdo Empresa -->
        <div class="content-wrapper empresa-content" id="empresaContent">
            <div class="content-header">
                <div class="header-info">
                    <h2>Gestão da Empresa</h2>
                    <p>Cadastre e gerencie empresas e departamentos</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="btnAddEmpresa">
                        <i class="fas fa-plus"></i>
                        Nova Empresa
                    </button>
                    <button class="btn btn-secondary" id="btnAddDepartamento">
                        <i class="fas fa-plus"></i>
                        Novo Departamento
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-section">
                <div class="filters-title">
                    <i class="fas fa-filter"></i>
                    Filtros
                </div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Empresa</label>
                        <input type="text" class="filter-input" id="filterEmpresa" placeholder="Digite o nome da empresa...">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Departamento</label>
                        <input type="text" class="filter-input" id="filterDepartamento" placeholder="Digite o nome do departamento...">
                    </div>
                </div>
            </div>

            <!-- Lista de Empresas -->
            <div class="data-section">
                <div class="section-title">
                    <i class="fas fa-building"></i>
                    Empresas Cadastradas
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="tabelaEmpresas">
                        <thead>
                            <tr>
                                <th>Nome da Empresa</th>
                                <th>Solicitações</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="empresasBody">
                            <!-- Dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptyEmpresas">
                    <i class="fas fa-building"></i>
                    <h3>Nenhuma empresa cadastrada</h3>
                    <p>Clique em "Nova Empresa" para adicionar sua primeira empresa.</p>
                </div>
            </div>

            <!-- Lista de Departamentos -->
            <div class="data-section">
                <div class="section-title">
                    <i class="fas fa-sitemap"></i>
                    Departamentos
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="tabelaDepartamentos">
                        <thead>
                            <tr>
                                <th>Nome do Departamento</th>
                                <th>Solicitações</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="departamentosBody">
                            <!-- Dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptyDepartamentos">
                    <i class="fas fa-sitemap"></i>
                    <h3>Nenhum departamento cadastrado</h3>
                    <p>Clique em "Novo Departamento" para adicionar seu primeiro departamento.</p>
                </div>
            </div>

            <!-- Footer removido conforme solicitado -->
        </div>

        <!-- Conteúdo Colaboradores -->
        <div class="content-wrapper colaboradores-content" id="colaboradoresContent">
            <div class="content-header">
                <div class="header-info">
                    <h2>Gestão de Colaboradores</h2>
                    <p>Cadastre e gerencie colaboradores da empresa</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="btnAddColaborador">
                        <i class="fas fa-plus"></i>
                        Novo Colaborador
                    </button>
                </div>
            </div>

            <!-- Filtros Colaboradores -->
            <div class="filters-section">
                <div class="filters-title">
                    <i class="fas fa-filter"></i>
                    Filtros de Colaboradores
                </div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Nome</label>
                        <input type="text" class="filter-input" id="filterNomeColaborador" placeholder="Digite o nome do colaborador...">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Status</label>
                        <select class="filter-select" id="filterStatusColaborador">
                            <option value="">Todos os Status</option>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Empresa</label>
                        <select class="filter-select" id="filterEmpresaColaborador">
                            <option value="">Todas as Empresas</option>
                            <!-- Empresas serão carregadas dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Departamento</label>
                        <select class="filter-select" id="filterDepartamentoColaborador">
                            <option value="">Todos os Departamentos</option>
                            <!-- Departamentos serão carregados dinamicamente -->
                        </select>
                    </div>
                </div>
            </div>

            <!-- Lista de Colaboradores -->
            <div class="data-section">
                <div class="section-title">
                    <i class="fas fa-users"></i>
                    Colaboradores Cadastrados
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="tabelaColaboradores">
                        <thead>
                            <tr>
                                <th>Nome Completo</th>
                                <th>Empresa</th>
                                <th>Departamento</th>
                                <th>Data Admissão</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="colaboradoresBody">
                            <!-- Dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptyColaboradores">
                    <i class="fas fa-users"></i>
                    <h3>Nenhum colaborador cadastrado</h3>
                    <p>Clique em "Novo Colaborador" para adicionar seu primeiro colaborador.</p>
                </div>
            </div>

            <!-- Footer removido conforme solicitado -->
        </div>

        <!-- Conteúdo Itens -->
        <div class="content-wrapper itens-content" id="itensContent">
            <div class="content-header">
                <div class="header-info">
                    <h2>Gestão de Itens</h2>
                    <p>Cadastre e gerencie os itens de uniforme disponíveis</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="btnAddItem">
                        <i class="fas fa-plus"></i>
                        Novo Item
                    </button>
                </div>
            </div>

            <!-- Filtros Itens -->
            <div class="filters-section">
                <div class="filters-title">
                    <i class="fas fa-filter"></i>
                    Filtros de Itens
                </div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Nome do Item</label>
                        <input type="text" class="filter-input" id="filterNomeItem" placeholder="Digite o nome do item...">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Categoria</label>
                        <select class="filter-select" id="filterCategoriaItem">
                            <option value="">Todas as Categorias</option>
                            <option value="uniforme">Uniforme</option>
                            <option value="epi">EPI</option>
                            <option value="material">Material</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Lista de Itens -->
            <div class="data-section">
                <div class="section-title">
                    <i class="fas fa-tshirt"></i>
                    Itens Cadastrados
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="tabelaItens">
                        <thead>
                            <tr>
                                <th>Nome do Item</th>
                                <th>Categoria</th>
                                <th>Tamanhos Disponíveis</th>
                                <th>Solicitações</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="itensBody">
                            <!-- Dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptyItens">
                    <i class="fas fa-tshirt"></i>
                    <h3>Nenhum item cadastrado</h3>
                    <p>Clique em "Novo Item" para adicionar seu primeiro item.</p>
                </div>
            </div>

            <!-- Footer removido conforme solicitado -->
        </div>

        <!-- Conteúdo Solicitações -->
        <div class="content-wrapper solicitacoes-content" id="solicitacoesContent">
            <div class="content-header">
                <div class="header-info">
                    <h2>Solicitações de Uniformes</h2>
                    <p>Gerencie as solicitações de uniformes dos colaboradores</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="btnAddSolicitacao">
                        <i class="fas fa-plus"></i>
                        Nova Solicitação
                    </button>
                </div>
            </div>

            <!-- Filtros Solicitações -->
            <div class="filters-section">
                <div class="filters-title">
                    <i class="fas fa-filter"></i>
                    Filtros de Solicitações
                </div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Colaborador</label>
                        <input type="text" class="filter-input" id="filterColaboradorSolicitacao" placeholder="Digite o nome do colaborador...">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Empresa</label>
                        <select class="filter-select" id="filterEmpresaSolicitacao">
                            <option value="">Todas as Empresas</option>
                            <!-- Empresas serão carregadas dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Departamento</label>
                        <select class="filter-select" id="filterDepartamentoSolicitacao">
                            <option value="">Todos os Departamentos</option>
                            <!-- Departamentos serão carregados dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Item</label>
                        <input type="text" class="filter-input" id="filterItemSolicitacao" placeholder="Digite o nome do item...">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Filtrar por Status</label>
                        <select class="filter-select" id="filterStatusSolicitacao">
                            <option value="">Todos os Status</option>
                            <option value="pendente">Pendente</option>
                            <option value="realizado">Realizado</option>
                            <option value="nao-precisa">Não Precisa</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Período Inicial</label>
                        <input type="date" class="filter-input" id="filterDataInicioSolicitacao">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Período Final</label>
                        <input type="date" class="filter-input" id="filterDataFimSolicitacao">
                    </div>
                </div>
            </div>

            <!-- Lista de Solicitações -->
            <div class="data-section">
                <div class="section-title">
                    <i class="fas fa-clipboard-check"></i>
                    Solicitações Cadastradas
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="tabelaSolicitacoes">
                        <thead>
                            <tr>
                                <th>Colaborador</th>
                                <th>Empresa</th>
                                <th>Departamento</th>
                                <th>Itens Solicitados</th>
                                <th>Data Solicitação</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="solicitacoesBody">
                            <!-- Dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptySolicitacoes">
                    <i class="fas fa-clipboard-check"></i>
                    <h3>Nenhuma solicitação cadastrada</h3>
                    <p>Clique em "Nova Solicitação" para adicionar sua primeira solicitação.</p>
                </div>
            </div>

            <!-- Footer removido conforme solicitado -->
        </div>

        <!-- Conteúdo Relatórios -->
        <div class="content-wrapper relatorios-content" id="relatoriosContent">
            <div class="content-header">
                <div class="header-info">
                    <h2>Relatórios</h2>
                    <p>Gere relatórios personalizados dos dados do sistema</p>
                </div>
            </div>

            <!-- Opções de Relatórios -->
            <div class="report-options-section">
                <div class="section-title">
                    <i class="fas fa-check-square"></i>
                    Selecione os Dados para o Relatório
                </div>
                
                <div class="report-options-grid" id="reportOptionsGrid">
                    <div class="report-option-card" data-report-type="empresas">
                        <div class="report-option-checkbox"></div>
                        <div class="report-option-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="report-option-title">Empresas</div>
                        <div class="report-option-description">
                            Lista de empresas cadastradas com informações de solicitações
                        </div>
                    </div>
                    
                    <div class="report-option-card" data-report-type="departamentos">
                        <div class="report-option-checkbox"></div>
                        <div class="report-option-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                        <div class="report-option-title">Departamentos</div>
                        <div class="report-option-description">
                            Lista de departamentos com quantidades de solicitações
                        </div>
                    </div>
                    
                    <div class="report-option-card" data-report-type="colaboradores">
                        <div class="report-option-checkbox"></div>
                        <div class="report-option-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="report-option-title">Colaboradores</div>
                        <div class="report-option-description">
                            Lista completa de colaboradores com status e empresa
                        </div>
                    </div>
                    
                    <div class="report-option-card" data-report-type="itens">
                        <div class="report-option-checkbox"></div>
                        <div class="report-option-icon">
                            <i class="fas fa-tshirt"></i>
                        </div>
                        <div class="report-option-title">Itens</div>
                        <div class="report-option-description">
                            Catálogo completo de itens com categorias e tamanhos
                        </div>
                    </div>
                    
                    <div class="report-option-card" data-report-type="solicitacoes">
                        <div class="report-option-checkbox"></div>
                        <div class="report-option-icon">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="report-option-title">Solicitações</div>
                        <div class="report-option-description">
                            Histórico completo de solicitações com status e itens
                        </div>
                    </div>
                    
                    <div class="report-option-card" data-report-type="dashboard">
                        <div class="report-option-checkbox"></div>
                        <div class="report-option-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="report-option-title">Dashboard</div>
                        <div class="report-option-description">
                            Resumo estatístico e métricas gerais do sistema
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filtros Avançados para Relatórios -->
            <div class="report-filters-section">
                <div class="section-title">
                    <i class="fas fa-filter"></i>
                    Filtros Avançados (Opcional)
                </div>
                
                <div class="report-filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Data Inicial</label>
                        <input type="date" class="filter-input" id="reportDataInicio">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Data Final</label>
                        <input type="date" class="filter-input" id="reportDataFim">
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Status (Solicitações)</label>
                        <select class="filter-select" id="reportStatus">
                            <option value="">Todos os Status</option>
                            <option value="pendente">Pendente</option>
                            <option value="realizado">Realizado</option>
                            <option value="nao-precisa">Não Precisa</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Empresa</label>
                        <select class="filter-select" id="reportEmpresa">
                            <option value="">Todas as Empresas</option>
                            <!-- Empresas serão carregadas dinamicamente -->
                        </select>
                    </div>
                </div>
                
                <div class="report-action-buttons">
                    <button class="export-btn excel" id="btnExportExcel">
                        <i class="fas fa-file-excel"></i>
                        Exportar para Excel
                    </button>
                    <button class="export-btn pdf" id="btnExportPDF">
                        <i class="fas fa-file-pdf"></i>
                        Exportar para PDF
                    </button>
                    <button class="btn btn-secondary" id="btnPreviewReport">
                        <i class="fas fa-eye"></i>
                        Visualizar Relatório
                    </button>
                </div>
            </div>

            <!-- Visualização do Relatório -->
            <div class="report-preview-section" id="reportPreviewSection">
                <div class="report-preview-title">
                    <i class="fas fa-eye"></i>
                    Pré-visualização do Relatório
                </div>
                
                <div class="report-preview-content" id="reportPreviewContent">
                    <!-- Conteúdo será gerado dinamicamente -->
                </div>
                
                <div class="report-action-buttons" style="margin-top: 20px;">
                    <button class="export-btn excel" id="btnExportPreviewExcel">
                        <i class="fas fa-file-excel"></i>
                        Exportar para Excel
                    </button>
                    <button class="export-btn pdf" id="btnExportPreviewPDF">
                        <i class="fas fa-file-pdf"></i>
                        Exportar para PDF
                    </button>
                </div>
            </div>

            <!-- Footer removido conforme solicitado -->
        </div>
    </main>

    <!-- Modal para Cadastrar Empresa -->
    <div class="modal-overlay" id="modalEmpresa">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nova Empresa</h3>
                <button class="modal-close" id="closeModalEmpresa">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formEmpresa">
                <div class="form-group">
                    <label class="form-label" for="nomeEmpresa">Nome da Empresa</label>
                    <input type="text" class="form-input" id="nomeEmpresa" placeholder="Digite o nome da empresa..." required>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelEmpresa">Cancelar</button>
                    <button type="submit" class="btn btn-primary btn-save">Salvar Empresa</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Cadastrar Departamento -->
    <div class="modal-overlay" id="modalDepartamento">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Novo Departamento</h3>
                <button class="modal-close" id="closeModalDepartamento">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formDepartamento">
                <div class="form-group">
                    <label class="form-label" for="nomeDepartamento">Nome do Departamento</label>
                    <input type="text" class="form-input" id="nomeDepartamento" placeholder="Digite o nome do departamento..." required>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelDepartamento">Cancelar</button>
                    <button type="submit" class="btn btn-primary btn-save">Salvar Departamento</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Cadastrar/Editar Colaborador -->
    <div class="modal-overlay" id="modalColaborador">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalColaboradorTitle">Novo Colaborador</h3>
                <button class="modal-close" id="closeModalColaborador">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formColaborador">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label" for="nomeColaborador">Nome Completo</label>
                        <input type="text" class="form-input" id="nomeColaborador" placeholder="Digite o nome completo do colaborador..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="empresaColaborador">Empresa</label>
                        <select class="form-select" id="empresaColaborador" required>
                            <option value="">Selecione uma empresa</option>
                            <!-- Empresas serão carregadas dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="departamentoColaborador">Departamento</label>
                        <select class="form-select" id="departamentoColaborador" required>
                            <option value="">Selecione um departamento</option>
                            <!-- Departamentos serão carregados dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="dataAdmissaoColaborador">Data de Admissão</label>
                        <input type="date" class="form-input" id="dataAdmissaoColaborador" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="statusColaborador">Status</label>
                        <select class="form-select" id="statusColaborador" required>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelColaborador">Cancelar</button>
                    <button type="submit" class="btn btn-primary btn-save" id="saveColaborador">Salvar Colaborador</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Cadastrar/Editar Item -->
    <div class="modal-overlay" id="modalItem">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalItemTitle">Novo Item</h3>
                <button class="modal-close" id="closeModalItem">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formItem">
                <div class="form-group">
                    <label class="form-label" for="nomeItem">Nome do Item</label>
                    <input type="text" class="form-input" id="nomeItem" placeholder="Digite o nome do item..." required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="categoriaItem">Categoria</label>
                    <select class="form-select" id="categoriaItem" required>
                        <option value="uniforme">Uniforme</option>
                        <option value="epi">EPI</option>
                        <option value="material">Material</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="tamanhosItem">Tamanhos Disponíveis</label>
                    <textarea class="form-textarea" id="tamanhosItem" placeholder="Digite os tamanhos separados por vírgula. Ex: P, M, G, GG, XG" rows="3"></textarea>
                    <div class="form-hint">Separe os tamanhos por vírgula. Ex: P, M, G, GG ou 36, 38, 40, 42</div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelItem">Cancelar</button>
                    <button type="submit" class="btn btn-primary btn-save" id="saveItem">Salvar Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal SIMPLIFICADO para Cadastrar/Editar Solicitação -->
    <div class="modal-overlay" id="modalSolicitacao">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalSolicitacaoTitle">Nova Solicitação</h3>
                <button class="modal-close" id="closeModalSolicitacao">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="formSolicitacao">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label" for="colaboradorSolicitacao">Colaborador</label>
                        <select class="form-select" id="colaboradorSolicitacao" required>
                            <option value="">Selecione um colaborador</option>
                            <!-- Colaboradores serão carregados dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="empresaSolicitacao">Empresa</label>
                        <input type="text" class="form-input" id="empresaSolicitacao" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="departamentoSolicitacao">Departamento</label>
                        <input type="text" class="form-input" id="departamentoSolicitacao" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Itens Solicitados</label>
                    <div class="itens-solicitacao-container" id="itensSolicitacaoContainer">
                        <!-- Primeiro item será adicionado automaticamente -->
                    </div>
                    <button type="button" class="add-item-btn" id="addItemSolicitacao">
                        <i class="fas fa-plus"></i>
                        Adicionar Outro Item
                    </button>
                </div>
                
                <div class="data-solicitacao-group">
                    <div class="form-group">
                        <label class="form-label" for="dataSolicitacao">Data da Solicitação</label>
                        <input type="date" class="form-input" id="dataSolicitacao" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="statusSolicitacao">Status</label>
                        <select class="form-select" id="statusSolicitacao" required>
                            <option value="pendente">Pendente</option>
                            <option value="realizado">Realizado</option>
                            <option value="nao-precisa">Não Precisa</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelSolicitacao">Cancelar</button>
                    <button type="submit" class="btn btn-primary btn-save" id="saveSolicitacao">Salvar Solicitação</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyChaix5zgGY6PANsVRAw_7TezgETg0eObM",
            authDomain: "gestao-uniformes-71bfc.firebaseapp.com",
            projectId: "gestao-uniformes-71bfc",
            storageBucket: "gestao-uniformes-71bfc.appspot.com",
            messagingSenderId: "47838007072",
            appId: "1:47838007072:web:bca426a25005cb07ecd145"
        };

        // Variáveis globais
        let db;
        let empresas = [];
        let departamentos = [];
        let colaboradores = [];
        let itens = [];
        let solicitacoes = [];
        let solicitacoesPorEmpresa = {};
        let solicitacoesPorDepartamento = {};
        let solicitacoesPorItem = {};
        let editandoColaboradorId = null;
        let editandoItemId = null;
        let editandoSolicitacaoId = null;
        
        // Variáveis para relatórios
        let selectedReportTypes = [];
        let currentReportData = null;
        
        // Variáveis para gráficos
        let chartItensMaisSolicitados = null;
        let chartDepartamentosMaisSolicitacoes = null;
        let chartColaboradoresMaisSolicitacoes = null;
        let chartDistribuicaoStatus = null;

        // Inicializar Firebase com tratamento de erro melhorado
        function inicializarFirebase() {
            try {
                // Usar compatibilidade para evitar problemas de versão
                if (typeof firebase === 'undefined') {
                    console.error("Firebase SDK não carregado!");
                    return false;
                }
                
                // Verificar se já foi inicializado
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                // Usar compatibilidade
                db = firebase.firestore();
                console.log("✅ Firebase inicializado com sucesso!");
                console.log("📊 Firestore configurado:", db);
                return true;
                
            } catch (error) {
                console.error("❌ Erro ao inicializar Firebase:", error);
                console.error("Detalhes do erro:", error.message);
                return false;
            }
        }

        // Elementos do DOM
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.querySelector('.sidebar');
        const sidebarOverlay = document.querySelector('.sidebar-overlay');
        const navLinks = document.querySelectorAll('.nav-link');
        
        // Elementos de conteúdo das páginas
        const pageTitle = document.getElementById('pageTitle');
        
        // Elementos das páginas de conteúdo
        const contentWrappers = {
            dashboard: document.getElementById('dashboardContent'),
            empresa: document.getElementById('empresaContent'),
            colaboradores: document.getElementById('colaboradoresContent'),
            itens: document.getElementById('itensContent'),
            solicitacoes: document.getElementById('solicitacoesContent'),
            relatorios: document.getElementById('relatoriosContent')
        };
        
        // Elementos do Dashboard
        const totalColaboradores = document.getElementById('totalColaboradores');
        const totalSolicitacoes = document.getElementById('totalSolicitacoes');
        const tempoMedioTroca = document.getElementById('tempoMedioTroca');
        const tempoMedioFiltro = document.getElementById('tempoMedioFiltro');
        const dashboardMetrica = document.getElementById('dashboardMetrica');
        const dashboardDetalhe = document.getElementById('dashboardDetalhe');
        const activityList = document.getElementById('activityList');
        
        // Elementos do Dashboard Filtros
        const dashboardDataInicio = document.getElementById('dashboardDataInicio');
        const dashboardDataFim = document.getElementById('dashboardDataFim');
        const dashboardEmpresa = document.getElementById('dashboardEmpresa');
        const dashboardDepartamento = document.getElementById('dashboardDepartamento');
        const dashboardItem = document.getElementById('dashboardItem');
        const btnAplicarFiltrosDashboard = document.getElementById('btnAplicarFiltrosDashboard');
        
        // Elementos da aba Empresa
        const btnAddEmpresa = document.getElementById('btnAddEmpresa');
        const btnAddDepartamento = document.getElementById('btnAddDepartamento');
        const filterEmpresa = document.getElementById('filterEmpresa');
        const filterDepartamento = document.getElementById('filterDepartamento');
        const empresasBody = document.getElementById('empresasBody');
        const departamentosBody = document.getElementById('departamentosBody');
        const emptyEmpresas = document.getElementById('emptyEmpresas');
        const emptyDepartamentos = document.getElementById('emptyDepartamentos');
        
        // Elementos da aba Colaboradores
        const btnAddColaborador = document.getElementById('btnAddColaborador');
        const filterNomeColaborador = document.getElementById('filterNomeColaborador');
        const filterStatusColaborador = document.getElementById('filterStatusColaborador');
        const filterEmpresaColaborador = document.getElementById('filterEmpresaColaborador');
        const filterDepartamentoColaborador = document.getElementById('filterDepartamentoColaborador');
        const colaboradoresBody = document.getElementById('colaboradoresBody');
        const emptyColaboradores = document.getElementById('emptyColaboradores');
        
        // Elementos da aba Itens
        const btnAddItem = document.getElementById('btnAddItem');
        const filterNomeItem = document.getElementById('filterNomeItem');
        const filterCategoriaItem = document.getElementById('filterCategoriaItem');
        const itensBody = document.getElementById('itensBody');
        const emptyItens = document.getElementById('emptyItens');
        
        // Elementos da aba Solicitações
        const btnAddSolicitacao = document.getElementById('btnAddSolicitacao');
        const filterColaboradorSolicitacao = document.getElementById('filterColaboradorSolicitacao');
        const filterEmpresaSolicitacao = document.getElementById('filterEmpresaSolicitacao');
        const filterDepartamentoSolicitacao = document.getElementById('filterDepartamentoSolicitacao');
        const filterItemSolicitacao = document.getElementById('filterItemSolicitacao');
        const filterStatusSolicitacao = document.getElementById('filterStatusSolicitacao');
        const filterDataInicioSolicitacao = document.getElementById('filterDataInicioSolicitacao');
        const filterDataFimSolicitacao = document.getElementById('filterDataFimSolicitacao');
        const solicitacoesBody = document.getElementById('solicitacoesBody');
        const emptySolicitacoes = document.getElementById('emptySolicitacoes');
        
        // Elementos da aba Relatórios
        const reportOptionsGrid = document.getElementById('reportOptionsGrid');
        const reportDataInicio = document.getElementById('reportDataInicio');
        const reportDataFim = document.getElementById('reportDataFim');
        const reportStatus = document.getElementById('reportStatus');
        const reportEmpresa = document.getElementById('reportEmpresa');
        const btnExportExcel = document.getElementById('btnExportExcel');
        const btnExportPDF = document.getElementById('btnExportPDF');
        const btnPreviewReport = document.getElementById('btnPreviewReport');
        const reportPreviewSection = document.getElementById('reportPreviewSection');
        const reportPreviewContent = document.getElementById('reportPreviewContent');
        const btnExportPreviewExcel = document.getElementById('btnExportPreviewExcel');
        const btnExportPreviewPDF = document.getElementById('btnExportPreviewPDF');
        
        // Elementos dos modais
        const modalEmpresa = document.getElementById('modalEmpresa');
        const modalDepartamento = document.getElementById('modalDepartamento');
        const modalColaborador = document.getElementById('modalColaborador');
        const modalItem = document.getElementById('modalItem');
        const modalSolicitacao = document.getElementById('modalSolicitacao');
        const closeModalEmpresa = document.getElementById('closeModalEmpresa');
        const closeModalDepartamento = document.getElementById('closeModalDepartamento');
        const closeModalColaborador = document.getElementById('closeModalColaborador');
        const closeModalItem = document.getElementById('closeModalItem');
        const closeModalSolicitacao = document.getElementById('closeModalSolicitacao');
        const cancelEmpresa = document.getElementById('cancelEmpresa');
        const cancelDepartamento = document.getElementById('cancelDepartamento');
        const cancelColaborador = document.getElementById('cancelColaborador');
        const cancelItem = document.getElementById('cancelItem');
        const cancelSolicitacao = document.getElementById('cancelSolicitacao');
        const formEmpresa = document.getElementById('formEmpresa');
        const formDepartamento = document.getElementById('formDepartamento');
        const formColaborador = document.getElementById('formColaborador');
        const formItem = document.getElementById('formItem');
        const formSolicitacao = document.getElementById('formSolicitacao');
        const nomeEmpresaInput = document.getElementById('nomeEmpresa');
        const nomeDepartamentoInput = document.getElementById('nomeDepartamento');
        const nomeColaboradorInput = document.getElementById('nomeColaborador');
        const empresaColaboradorSelect = document.getElementById('empresaColaborador');
        const departamentoColaboradorSelect = document.getElementById('departamentoColaborador');
        const dataAdmissaoColaboradorInput = document.getElementById('dataAdmissaoColaborador');
        const statusColaboradorSelect = document.getElementById('statusColaborador');
        const modalColaboradorTitle = document.getElementById('modalColaboradorTitle');
        const saveColaboradorBtn = document.getElementById('saveColaborador');
        const nomeItemInput = document.getElementById('nomeItem');
        const categoriaItemSelect = document.getElementById('categoriaItem');
        const tamanhosItemTextarea = document.getElementById('tamanhosItem');
        const modalItemTitle = document.getElementById('modalItemTitle');
        const saveItemBtn = document.getElementById('saveItem');
        const colaboradorSolicitacaoSelect = document.getElementById('colaboradorSolicitacao');
        const empresaSolicitacaoInput = document.getElementById('empresaSolicitacao');
        const departamentoSolicitacaoInput = document.getElementById('departamentoSolicitacao');
        const itensSolicitacaoContainer = document.getElementById('itensSolicitacaoContainer');
        const addItemSolicitacaoBtn = document.getElementById('addItemSolicitacao');
        const dataSolicitacaoInput = document.getElementById('dataSolicitacao');
        const statusSolicitacaoSelect = document.getElementById('statusSolicitacao');
        const modalSolicitacaoTitle = document.getElementById('modalSolicitacaoTitle');
        const saveSolicitacaoBtn = document.getElementById('saveSolicitacao');

        // Adicionar atividade ao dashboard
        function adicionarAtividade(texto) {
            const agora = new Date();
            const hora = agora.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const atividadeItem = document.createElement('li');
            atividadeItem.className = 'activity-item';
            atividadeItem.innerHTML = `
                <div class="activity-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-text">${texto}</div>
                    <div class="activity-time">${hora}</div>
                </div>
            `;
            
            // Adicionar no início da lista
            activityList.insertBefore(atividadeItem, activityList.firstChild);
            
            // Manter apenas as últimas 5 atividades
            while (activityList.children.length > 5) {
                activityList.removeChild(activityList.lastChild);
            }
        }

        // Atualizar estatísticas do dashboard
        function atualizarEstatisticas() {
            totalColaboradores.textContent = colaboradores.length;
            totalSolicitacoes.textContent = solicitacoes.length;
            
            // Atualizar solicitações pendentes
            const solicitacoesPendentes = solicitacoes.filter(s => s.status === 'pendente').length;
            dashboardMetrica.textContent = solicitacoesPendentes;
            dashboardDetalhe.textContent = `De ${solicitacoes.length} solicitações totais`;
            
            // Calcular tempo médio de troca
            calcularTempoMedioTroca();
        }

        // Calcular tempo médio de troca
        function calcularTempoMedioTroca() {
            if (solicitacoes.length === 0) {
                tempoMedioTroca.textContent = "0";
                return;
            }
            
            // Agrupar solicitações por colaborador e item
            const historicoColaboradorItem = {};
            
            solicitacoes.forEach(solicitacao => {
                if (solicitacao.status === 'realizado' && solicitacao.itens && solicitacao.itens.length > 0) {
                    const colaboradorId = solicitacao.colaboradorId;
                    
                    solicitacao.itens.forEach(item => {
                        const chave = `${colaboradorId}-${item.itemId}`;
                        
                        if (!historicoColaboradorItem[chave]) {
                            historicoColaboradorItem[chave] = [];
                        }
                        
                        historicoColaboradorItem[chave].push(new Date(solicitacao.dataSolicitacao));
                    });
                }
            });
            
            // Calcular intervalos médios
            let totalIntervalos = 0;
            let contagemIntervalos = 0;
            
            Object.values(historicoColaboradorItem).forEach(datas => {
                // Ordenar datas da mais antiga para a mais recente
                datas.sort((a, b) => a - b);
                
                // Calcular intervalos entre solicitações consecutivas
                for (let i = 1; i < datas.length; i++) {
                    const intervalo = datas[i] - datas[i-1]; // em milissegundos
                    totalIntervalos += intervalo;
                    contagemIntervalos++;
                }
            });
            
            if (contagemIntervalos === 0) {
                tempoMedioTroca.textContent = "N/A";
                return;
            }
            
            // Converter para unidade selecionada
            const unidade = tempoMedioFiltro.value;
            const intervaloMedioMs = totalIntervalos / contagemIntervalos;
            
            let tempoMedio;
            let texto;
            
            switch(unidade) {
                case 'dias':
                    tempoMedio = intervaloMedioMs / (1000 * 60 * 60 * 24);
                    texto = Math.round(tempoMedio * 10) / 10;
                    break;
                case 'meses':
                    tempoMedio = intervaloMedioMs / (1000 * 60 * 60 * 24 * 30);
                    texto = Math.round(tempoMedio * 10) / 10;
                    break;
                case 'anos':
                    tempoMedio = intervaloMedioMs / (1000 * 60 * 60 * 24 * 365);
                    texto = Math.round(tempoMedio * 10) / 10;
                    break;
                default:
                    tempoMedio = intervaloMedioMs / (1000 * 60 * 60 * 24);
                    texto = Math.round(tempoMedio * 10) / 10;
            }
            
            tempoMedioTroca.textContent = texto;
        }

        // Função para obter classe CSS baseada na quantidade de solicitações
        function getSolicitacoesClass(quantidade) {
            if (quantidade === 0) return 'zero';
            if (quantidade <= 5) return 'baixa';
            if (quantidade <= 15) return 'media';
            return 'alta';
        }

        // Calcular solicitações por empresa
        function calcularSolicitacoesPorEmpresa() {
            solicitacoesPorEmpresa = {};
            
            empresas.forEach(empresa => {
                const count = solicitacoes.filter(s => 
                    s.empresaId === empresa.id || 
                    (s.empresa && s.empresa === empresa.nome)
                ).length;
                
                solicitacoesPorEmpresa[empresa.id] = count;
            });
        }

        // Calcular solicitações por departamento
        function calcularSolicitacoesPorDepartamento() {
            solicitacoesPorDepartamento = {};
            
            departamentos.forEach(depto => {
                const count = solicitacoes.filter(s => 
                    s.departamentoId === depto.id || 
                    (s.departamento && s.departamento === depto.nome)
                ).length;
                
                solicitacoesPorDepartamento[depto.id] = count;
            });
        }

        // Calcular solicitações por item
        function calcularSolicitacoesPorItem() {
            solicitacoesPorItem = {};
            
            itens.forEach(item => {
                const count = solicitacoes.filter(s => 
                    s.itens && s.itens.some(i => i.itemId === item.id)
                ).length;
                
                solicitacoesPorItem[item.id] = count;
            });
        }

        // Carregar dados do Firebase
        function carregarDadosFirebase() {
            try {
                if (!db) {
                    console.error("Firebase não inicializado!");
                    adicionarAtividade("⚠️ Modo offline - Firebase não conectado");
                    usarDadosMock();
                    return;
                }
                
                console.log("🔄 Carregando dados do Firebase...");
                
                // Configurar listeners em tempo real para empresas
                db.collection('empresas')
                    .orderBy('criadoEm', 'desc')
                    .onSnapshot((snapshot) => {
                        console.log("📁 Snapshot empresas recebido");
                        empresas = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            empresas.push({
                                id: doc.id,
                                nome: data.nome || '',
                                criadoEm: data.criadoEm ? data.criadoEm.toDate() : new Date()
                            });
                        });
                        console.log(`✅ ${empresas.length} empresas carregadas`);
                        calcularSolicitacoesPorEmpresa();
                        carregarEmpresas();
                        atualizarFiltrosColaboradores();
                        atualizarFiltrosSolicitacoes();
                        atualizarSelectsModalColaborador();
                        atualizarSelectColaboradoresSolicitacao();
                        atualizarEstatisticas();
                        atualizarFiltrosRelatorios();
                        atualizarFiltrosDashboard();
                        
                        if (empresas.length > 0) {
                            adicionarAtividade(`${empresas.length} empresas carregadas`);
                        }
                    }, (error) => {
                        console.error('❌ Erro ao carregar empresas:', error);
                        adicionarAtividade('⚠️ Erro ao carregar empresas');
                        usarDadosMock();
                    });

                // Configurar listeners em tempo real para departamentos
                db.collection('departamentos')
                    .orderBy('criadoEm', 'desc')
                    .onSnapshot((snapshot) => {
                        console.log("📁 Snapshot departamentos recebido");
                        departamentos = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            departamentos.push({
                                id: doc.id,
                                nome: data.nome || '',
                                criadoEm: data.criadoEm ? data.criadoEm.toDate() : new Date()
                            });
                        });
                        console.log(`✅ ${departamentos.length} departamentos carregados`);
                        calcularSolicitacoesPorDepartamento();
                        carregarDepartamentos();
                        atualizarFiltrosColaboradores();
                        atualizarFiltrosSolicitacoes();
                        atualizarSelectsModalColaborador();
                        atualizarEstatisticas();
                        atualizarFiltrosDashboard();
                    }, (error) => {
                        console.error('❌ Erro ao carregar departamentos:', error);
                        adicionarAtividade('⚠️ Erro ao carregar departamentos');
                    });

                // Configurar listeners em tempo real para colaboradores
                db.collection('colaboradores')
                    .orderBy('criadoEm', 'desc')
                    .onSnapshot((snapshot) => {
                        console.log("📁 Snapshot colaboradores recebido");
                        colaboradores = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            colaboradores.push({
                                id: doc.id,
                                nome: data.nome || '',
                                empresaId: data.empresaId || '',
                                empresa: data.empresa || '',
                                departamentoId: data.departamentoId || '',
                                departamento: data.departamento || '',
                                dataAdmissao: data.dataAdmissao ? data.dataAdmissao.toDate() : new Date(),
                                status: data.status || 'ativo',
                                criadoEm: data.criadoEm ? data.criadoEm.toDate() : new Date()
                            });
                        });
                        console.log(`✅ ${colaboradores.length} colaboradores carregados`);
                        carregarColaboradores();
                        atualizarSelectColaboradoresSolicitacao();
                        atualizarEstatisticas();
                        atualizarFiltrosDashboard();
                        
                        if (colaboradores.length > 0) {
                            adicionarAtividade(`${colaboradores.length} colaboradores carregados`);
                        }
                    }, (error) => {
                        console.error('❌ Erro ao carregar colaboradores:', error);
                        adicionarAtividade('⚠️ Erro ao carregar colaboradores');
                    });

                // Configurar listeners em tempo real para itens
                db.collection('itens')
                    .orderBy('criadoEm', 'desc')
                    .onSnapshot((snapshot) => {
                        console.log("📁 Snapshot itens recebido");
                        itens = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            itens.push({
                                id: doc.id,
                                nome: data.nome || '',
                                categoria: data.categoria || 'uniforme',
                                tamanhos: data.tamanhos || [],
                                criadoEm: data.criadoEm ? data.criadoEm.toDate() : new Date()
                            });
                        });
                        console.log(`✅ ${itens.length} itens carregados`);
                        calcularSolicitacoesPorItem();
                        carregarItens();
                        atualizarItensSelectSolicitacao();
                        atualizarEstatisticas();
                        atualizarFiltrosDashboard();
                        
                        if (itens.length > 0) {
                            adicionarAtividade(`${itens.length} itens carregados`);
                        }
                    }, (error) => {
                        console.error('❌ Erro ao carregar itens:', error);
                        adicionarAtividade('⚠️ Erro ao carregar itens');
                    });

                // Configurar listeners em tempo real para solicitações
                db.collection('solicitacoes')
                    .orderBy('dataSolicitacao', 'desc')
                    .onSnapshot((snapshot) => {
                        console.log("📁 Snapshot solicitações recebido");
                        solicitacoes = [];
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            solicitacoes.push({
                                id: doc.id,
                                colaboradorId: data.colaboradorId || '',
                                colaborador: data.colaborador || '',
                                empresaId: data.empresaId || '',
                                empresa: data.empresa || '',
                                departamentoId: data.departamentoId || '',
                                departamento: data.departamento || '',
                                itens: data.itens || [],
                                dataSolicitacao: data.dataSolicitacao ? data.dataSolicitacao.toDate() : new Date(),
                                status: data.status || 'pendente',
                                criadoEm: data.criadoEm ? data.criadoEm.toDate() : new Date()
                            });
                        });
                        console.log(`✅ ${solicitacoes.length} solicitações carregadas`);
                        
                        // Recalcular contagens
                        calcularSolicitacoesPorEmpresa();
                        calcularSolicitacoesPorDepartamento();
                        calcularSolicitacoesPorItem();
                        
                        // Atualizar tabelas
                        carregarEmpresas();
                        carregarDepartamentos();
                        carregarItens();
                        carregarSolicitacoes();
                        atualizarEstatisticas();
                        atualizarGraficosDashboard();
                        
                        if (solicitacoes.length > 0) {
                            adicionarAtividade(`${solicitacoes.length} solicitações carregadas`);
                        }
                    }, (error) => {
                        console.error('❌ Erro ao carregar solicitações:', error);
                        adicionarAtividade('⚠️ Erro ao carregar solicitações');
                    });

                adicionarAtividade('Sistema carregado com sucesso');
                
            } catch (error) {
                console.error('❌ Erro geral ao carregar dados do Firebase:', error);
                adicionarAtividade('⚠️ Erro ao conectar com o banco de dados');
                usarDadosMock();
            }
        }

        // Função para usar dados mock em caso de erro no Firebase
        function usarDadosMock() {
            console.log("📋 Usando dados mock (modo offline)");
            
            // Dados mock de exemplo
            empresas = [
                { id: '1', nome: 'Empresa Exemplo 1', criadoEm: new Date() },
                { id: '2', nome: 'Empresa Exemplo 2', criadoEm: new Date() }
            ];
            
            departamentos = [
                { id: '1', nome: 'RH - Recursos Humanos', criadoEm: new Date() },
                { id: '2', nome: 'TI - Tecnologia da Informação', criadoEm: new Date() },
                { id: '3', nome: 'Vendas', criadoEm: new Date() }
            ];
            
            colaboradores = [
                { 
                    id: '1', 
                    nome: 'João Silva', 
                    empresaId: '1', 
                    empresa: 'Empresa Exemplo 1', 
                    departamentoId: '1', 
                    departamento: 'RH - Recursos Humanos', 
                    dataAdmissao: new Date('2022-03-15'), 
                    status: 'ativo',
                    criadoEm: new Date()
                },
                { 
                    id: '2', 
                    nome: 'Maria Santos', 
                    empresaId: '1', 
                    empresa: 'Empresa Exemplo 1', 
                    departamentoId: '2', 
                    departamento: 'TI - Tecnologia da Informação', 
                    dataAdmissao: new Date('2021-08-22'), 
                    status: 'ativo',
                    criadoEm: new Date()
                },
                { 
                    id: '3', 
                    nome: 'Carlos Oliveira', 
                    empresaId: '2', 
                    empresa: 'Empresa Exemplo 2', 
                    departamentoId: '3', 
                    departamento: 'Vendas', 
                    dataAdmissao: new Date('2023-01-10'), 
                    status: 'inativo',
                    criadoEm: new Date()
                }
            ];
            
            itens = [
                {
                    id: '1',
                    nome: 'Camiseta Polo',
                    categoria: 'uniforme',
                    tamanhos: ['P', 'M', 'G', 'GG'],
                    criadoEm: new Date()
                },
                {
                    id: '2',
                    nome: 'Calça Social',
                    categoria: 'uniforme',
                    tamanhos: ['38', '40', '42', '44', '46'],
                    criadoEm: new Date()
                },
                {
                    id: '3',
                    nome: 'Capacete de Segurança',
                    categoria: 'epi',
                    tamanhos: ['Único'],
                    criadoEm: new Date()
                },
                {
                    id: '4',
                    nome: 'Luvas de Proteção',
                    categoria: 'epi',
                    tamanhos: ['P', 'M', 'G'],
                    criadoEm: new Date()
                },
                {
                    id: '5',
                    nome: 'Caneta',
                    categoria: 'material',
                    tamanhos: ['Único'],
                    criadoEm: new Date()
                }
            ];
            
            // Dados mock de solicitações
            const dataAtual = new Date();
            const umMesAtras = new Date(dataAtual);
            umMesAtras.setMonth(umMesAtras.getMonth() - 1);
            
            const doisMesesAtras = new Date(dataAtual);
            doisMesesAtras.setMonth(doisMesesAtras.getMonth() - 2);
            
            const tresMesesAtras = new Date(dataAtual);
            tresMesesAtras.setMonth(tresMesesAtras.getMonth() - 3);
            
            solicitacoes = [
                { 
                    id: '1', 
                    colaboradorId: '1', 
                    colaborador: 'João Silva', 
                    empresaId: '1', 
                    empresa: 'Empresa Exemplo 1', 
                    departamentoId: '1', 
                    departamento: 'RH - Recursos Humanos', 
                    itens: [
                        { itemId: '1', item: 'Camiseta Polo', tamanho: 'G', quantidade: 2 },
                        { itemId: '2', item: 'Calça Social', tamanho: '42', quantidade: 1 }
                    ],
                    dataSolicitacao: dataAtual,
                    status: 'pendente',
                    criadoEm: dataAtual
                },
                { 
                    id: '2', 
                    colaboradorId: '2', 
                    colaborador: 'Maria Santos', 
                    empresaId: '1', 
                    empresa: 'Empresa Exemplo 1', 
                    departamentoId: '2', 
                    departamento: 'TI - Tecnologia da Informação', 
                    itens: [
                        { itemId: '3', item: 'Capacete de Segurança', tamanho: 'Único', quantidade: 1 },
                        { itemId: '4', item: 'Luvas de Proteção', tamanho: 'M', quantidade: 2 }
                    ],
                    dataSolicitacao: umMesAtras,
                    status: 'realizado',
                    criadoEm: umMesAtras
                },
                { 
                    id: '3', 
                    colaboradorId: '3', 
                    colaborador: 'Carlos Oliveira', 
                    empresaId: '2', 
                    empresa: 'Empresa Exemplo 2', 
                    departamentoId: '3', 
                    departamento: 'Vendas', 
                    itens: [
                        { itemId: '1', item: 'Camiseta Polo', tamanho: 'M', quantidade: 3 },
                        { itemId: '5', item: 'Caneta', tamanho: 'Único', quantidade: 5 }
                    ],
                    dataSolicitacao: doisMesesAtras,
                    status: 'realizado',
                    criadoEm: doisMesesAtras
                },
                { 
                    id: '4', 
                    colaboradorId: '1', 
                    colaborador: 'João Silva', 
                    empresaId: '1', 
                    empresa: 'Empresa Exemplo 1', 
                    departamentoId: '1', 
                    departamento: 'RH - Recursos Humanos', 
                    itens: [
                        { itemId: '1', item: 'Camiseta Polo', tamanho: 'G', quantidade: 1 },
                        { itemId: '2', item: 'Calça Social', tamanho: '42', quantidade: 1 }
                    ],
                    dataSolicitacao: tresMesesAtras,
                    status: 'realizado',
                    criadoEm: tresMesesAtras
                },
                { 
                    id: '5', 
                    colaboradorId: '2', 
                    colaborador: 'Maria Santos', 
                    empresaId: '1', 
                    empresa: 'Empresa Exemplo 1', 
                    departamentoId: '2', 
                    departamento: 'TI - Tecnologia da Informação', 
                    itens: [
                        { itemId: '4', item: 'Luvas de Proteção', tamanho: 'M', quantidade: 2 }
                    ],
                    dataSolicitacao: new Date('2023-01-15'),
                    status: 'nao-precisa',
                    criadoEm: new Date('2023-01-15')
                }
            ];
            
            // Calcular contagens
            calcularSolicitacoesPorEmpresa();
            calcularSolicitacoesPorDepartamento();
            calcularSolicitacoesPorItem();
            
            carregarEmpresas();
            carregarDepartamentos();
            carregarColaboradores();
            carregarItens();
            carregarSolicitacoes();
            atualizarFiltrosColaboradores();
            atualizarFiltrosSolicitacoes();
            atualizarSelectsModalColaborador();
            atualizarSelectColaboradoresSolicitacao();
            atualizarItensSelectSolicitacao();
            atualizarFiltrosRelatorios();
            atualizarFiltrosDashboard();
            atualizarEstatisticas();
            atualizarGraficosDashboard();
            
            adicionarAtividade('Modo offline - Dados de exemplo carregados');
        }

        // Atualizar filtros do dashboard
        function atualizarFiltrosDashboard() {
            // Configurar data padrão para o mês atual
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            
            if (!dashboardDataInicio.value) {
                dashboardDataInicio.value = primeiroDiaMes.toISOString().split('T')[0];
            }
            
            if (!dashboardDataFim.value) {
                dashboardDataFim.value = hoje.toISOString().split('T')[0];
            }
            
            // Atualizar filtro de empresas
            const empresaSelect = dashboardEmpresa;
            empresaSelect.innerHTML = '<option value="">Todas as Empresas</option>';
            empresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nome;
                empresaSelect.appendChild(option);
            });
            
            // Atualizar filtro de departamentos
            const departamentoSelect = dashboardDepartamento;
            departamentoSelect.innerHTML = '<option value="">Todos os Departamentos</option>';
            departamentos.forEach(departamento => {
                const option = document.createElement('option');
                option.value = departamento.id;
                option.textContent = departamento.nome;
                departamentoSelect.appendChild(option);
            });
            
            // Atualizar filtro de itens
            const itemSelect = dashboardItem;
            itemSelect.innerHTML = '<option value="">Todos os Itens</option>';
            itens.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.nome;
                itemSelect.appendChild(option);
            });
        }

        // Atualizar filtros de colaboradores
        function atualizarFiltrosColaboradores() {
            // Atualizar filtro de empresas
            const empresaSelect = filterEmpresaColaborador;
            empresaSelect.innerHTML = '<option value="">Todas as Empresas</option>';
            empresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nome;
                empresaSelect.appendChild(option);
            });
            
            // Atualizar filtro de departamentos
            const departamentoSelect = filterDepartamentoColaborador;
            departamentoSelect.innerHTML = '<option value="">Todos os Departamentos</option>';
            departamentos.forEach(departamento => {
                const option = document.createElement('option');
                option.value = departamento.id;
                option.textContent = departamento.nome;
                departamentoSelect.appendChild(option);
            });
        }

        // Atualizar filtros de solicitações
        function atualizarFiltrosSolicitacoes() {
            // Atualizar filtro de empresas
            const empresaSelect = filterEmpresaSolicitacao;
            empresaSelect.innerHTML = '<option value="">Todas as Empresas</option>';
            empresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nome;
                empresaSelect.appendChild(option);
            });
            
            // Atualizar filtro de departamentos
            const departamentoSelect = filterDepartamentoSolicitacao;
            departamentoSelect.innerHTML = '<option value="">Todos os Departamentos</option>';
            departamentos.forEach(departamento => {
                const option = document.createElement('option');
                option.value = departamento.id;
                option.textContent = departamento.nome;
                departamentoSelect.appendChild(option);
            });
        }

        // Atualizar filtros de relatórios
        function atualizarFiltrosRelatorios() {
            // Atualizar filtro de empresas
            const empresaSelect = reportEmpresa;
            empresaSelect.innerHTML = '<option value="">Todas as Empresas</option>';
            empresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nome;
                empresaSelect.appendChild(option);
            });
        }

        // Atualizar select de colaboradores na modal de solicitação
        function atualizarSelectColaboradoresSolicitacao() {
            colaboradorSolicitacaoSelect.innerHTML = '<option value="">Selecione um colaborador</option>';
            colaboradores.filter(c => c.status === 'ativo').forEach(colaborador => {
                const option = document.createElement('option');
                option.value = colaborador.id;
                option.textContent = `${colaborador.nome} - ${colaborador.empresa}`;
                colaboradorSolicitacaoSelect.appendChild(option);
            });
        }

        // Atualizar selects no modal de colaborador
        function atualizarSelectsModalColaborador() {
            empresaColaboradorSelect.innerHTML = '<option value="">Selecione uma empresa</option>';
            empresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nome;
                empresaColaboradorSelect.appendChild(option);
            });
            
            departamentoColaboradorSelect.innerHTML = '<option value="">Selecione um departamento</option>';
            departamentos.forEach(departamento => {
                const option = document.createElement('option');
                option.value = departamento.id;
                option.textContent = departamento.nome;
                departamentoColaboradorSelect.appendChild(option);
            });
        }

        // Atualizar select de itens na modal de solicitação
        function atualizarItensSelectSolicitacao() {
            const itemSelects = itensSolicitacaoContainer.querySelectorAll('.item-select');
            itemSelects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Selecione um item</option>';
                itens.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.nome;
                    select.appendChild(option);
                });
                select.value = currentValue;
                if (select.value) {
                    atualizarTamanhosSelect(select);
                }
            });
        }

        // Atualizar select de tamanhos quando item é selecionado
        function atualizarTamanhosSelect(itemSelect) {
            const itemId = itemSelect.value;
            const itemRow = itemSelect.closest('.item-row');
            const tamanhoSelect = itemRow.querySelector('.tamanho-select');
            const item = itens.find(i => i.id === itemId);
            
            tamanhoSelect.innerHTML = '<option value="">Selecione um tamanho</option>';
            
            if (item && item.tamanhos && item.tamanhos.length > 0) {
                item.tamanhos.forEach(tamanho => {
                    const option = document.createElement('option');
                    option.value = tamanho;
                    option.textContent = tamanho;
                    tamanhoSelect.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = 'Único';
                option.textContent = 'Único';
                tamanhoSelect.appendChild(option);
            }
        }

        // Atualizar gráficos do dashboard
        function atualizarGraficosDashboard() {
            // Obter dados filtrados
            const dadosFiltrados = aplicarFiltrosDashboard();
            
            // Dados para os gráficos
            const dadosItensMaisSolicitados = calcularTopItens(dadosFiltrados.solicitacoesFiltradas);
            const dadosDepartamentosMaisSolicitacoes = calcularTopDepartamentos(dadosFiltrados.solicitacoesFiltradas);
            const dadosColaboradoresMaisSolicitacoes = calcularTopColaboradores(dadosFiltrados.solicitacoesFiltradas);
            const dadosDistribuicaoStatus = calcularDistribuicaoStatus(dadosFiltrados.solicitacoesFiltradas);
            
            // Atualizar ou criar gráficos
            atualizarGraficoItensMaisSolicitados(dadosItensMaisSolicitados);
            atualizarGraficoDepartamentosMaisSolicitacoes(dadosDepartamentosMaisSolicitacoes);
            atualizarGraficoColaboradoresMaisSolicitacoes(dadosColaboradoresMaisSolicitacoes);
            atualizarGraficoDistribuicaoStatus(dadosDistribuicaoStatus);
            
            // Atualizar estatísticas com dados filtrados
            atualizarEstatisticasDashboard(dadosFiltrados);
        }

        // Aplicar filtros do dashboard
        function aplicarFiltrosDashboard() {
            const dataInicio = dashboardDataInicio.value ? new Date(dashboardDataInicio.value) : null;
            const dataFim = dashboardDataFim.value ? new Date(dashboardDataFim.value) : null;
            const empresaFiltro = dashboardEmpresa.value;
            const departamentoFiltro = dashboardDepartamento.value;
            const itemFiltro = dashboardItem.value;
            
            // Filtrar solicitações
            let solicitacoesFiltradas = solicitacoes;
            
            // Filtrar por data
            if (dataInicio) {
                const dataInicioAjustada = new Date(dataInicio);
                dataInicioAjustada.setDate(dataInicioAjustada.getDate() - 1); // Ajustar fuso horário
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    new Date(s.dataSolicitacao) >= dataInicioAjustada
                );
            }
            
            if (dataFim) {
                const dataFimAjustada = new Date(dataFim);
                dataFimAjustada.setDate(dataFimAjustada.getDate()); // Não ajustar
                dataFimAjustada.setHours(23, 59, 59, 999); // Fim do dia
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    new Date(s.dataSolicitacao) <= dataFimAjustada
                );
            }
            
            // Filtrar por empresa
            if (empresaFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.empresaId === empresaFiltro
                );
            }
            
            // Filtrar por departamento
            if (departamentoFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.departamentoId === departamentoFiltro
                );
            }
            
            // Filtrar por item
            if (itemFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.itens && s.itens.some(i => i.itemId === itemFiltro)
                );
            }
            
            // Filtrar empresas
            let empresasFiltradas = empresas;
            if (empresaFiltro) {
                empresasFiltradas = empresasFiltradas.filter(e => e.id === empresaFiltro);
            }
            
            // Filtrar departamentos
            let departamentosFiltrados = departamentos;
            if (departamentoFiltro) {
                departamentosFiltrados = departamentosFiltrados.filter(d => d.id === departamentoFiltro);
            }
            
            // Filtrar colaboradores
            let colaboradoresFiltrados = colaboradores;
            if (empresaFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => c.empresaId === empresaFiltro);
            }
            if (departamentoFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => c.departamentoId === departamentoFiltro);
            }
            
            // Filtrar itens
            let itensFiltrados = itens;
            if (itemFiltro) {
                itensFiltrados = itensFiltrados.filter(i => i.id === itemFiltro);
            }
            
            return {
                solicitacoesFiltradas,
                empresasFiltradas,
                departamentosFiltrados,
                colaboradoresFiltrados,
                itensFiltrados
            };
        }

        // Calcular top 5 itens mais solicitados
        function calcularTopItens(solicitacoesFiltradas) {
            const contagemItens = {};
            
            solicitacoesFiltradas.forEach(solicitacao => {
                if (solicitacao.itens && solicitacao.itens.length > 0) {
                    solicitacao.itens.forEach(item => {
                        if (!contagemItens[item.itemId]) {
                            contagemItens[item.itemId] = {
                                nome: item.item,
                                quantidade: 0
                            };
                        }
                        contagemItens[item.itemId].quantidade += item.quantidade;
                    });
                }
            });
            
            // Converter para array e ordenar
            const itensArray = Object.values(contagemItens);
            itensArray.sort((a, b) => b.quantidade - a.quantidade);
            
            return itensArray.slice(0, 5);
        }

        // Calcular top 5 departamentos que mais solicitam
        function calcularTopDepartamentos(solicitacoesFiltradas) {
            const contagemDepartamentos = {};
            
            solicitacoesFiltradas.forEach(solicitacao => {
                const departamentoId = solicitacao.departamentoId;
                const departamentoNome = solicitacao.departamento;
                
                if (!contagemDepartamentos[departamentoId]) {
                    contagemDepartamentos[departamentoId] = {
                        nome: departamentoNome,
                        quantidade: 0
                    };
                }
                contagemDepartamentos[departamentoId].quantidade++;
            });
            
            // Converter para array e ordenar
            const departamentosArray = Object.values(contagemDepartamentos);
            departamentosArray.sort((a, b) => b.quantidade - a.quantidade);
            
            return departamentosArray.slice(0, 5);
        }

        // Calcular top 5 colaboradores que mais solicitam
        function calcularTopColaboradores(solicitacoesFiltradas) {
            const contagemColaboradores = {};
            
            solicitacoesFiltradas.forEach(solicitacao => {
                const colaboradorId = solicitacao.colaboradorId;
                const colaboradorNome = solicitacao.colaborador;
                
                if (!contagemColaboradores[colaboradorId]) {
                    contagemColaboradores[colaboradorId] = {
                        nome: colaboradorNome,
                        quantidade: 0
                    };
                }
                contagemColaboradores[colaboradorId].quantidade++;
            });
            
            // Converter para array e ordenar
            const colaboradoresArray = Object.values(contagemColaboradores);
            colaboradoresArray.sort((a, b) => b.quantidade - a.quantidade);
            
            return colaboradoresArray.slice(0, 5);
        }

        // Calcular distribuição por status
        function calcularDistribuicaoStatus(solicitacoesFiltradas) {
            const contagemStatus = {
                pendente: 0,
                realizado: 0,
                'nao-precisa': 0
            };
            
            solicitacoesFiltradas.forEach(solicitacao => {
                if (contagemStatus[solicitacao.status] !== undefined) {
                    contagemStatus[solicitacao.status]++;
                }
            });
            
            return contagemStatus;
        }

        // Atualizar gráfico de itens mais solicitados
        function atualizarGraficoItensMaisSolicitados(dados) {
            const ctx = document.getElementById('chartItensMaisSolicitados').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (chartItensMaisSolicitados) {
                chartItensMaisSolicitados.destroy();
            }
            
            // Preparar dados para o gráfico
            const labels = dados.map(item => item.nome);
            const valores = dados.map(item => item.quantidade);
            const cores = [
                'rgba(74, 111, 165, 0.7)',
                'rgba(107, 140, 198, 0.7)',
                'rgba(56, 161, 105, 0.7)',
                'rgba(255, 126, 95, 0.7)',
                'rgba(214, 158, 46, 0.7)'
            ];
            
            // Criar novo gráfico
            chartItensMaisSolicitados = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Quantidade Solicitada',
                        data: valores,
                        backgroundColor: cores,
                        borderColor: cores.map(cor => cor.replace('0.7', '1')),
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Quantidade: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Atualizar gráfico de departamentos que mais solicitam
        function atualizarGraficoDepartamentosMaisSolicitacoes(dados) {
            const ctx = document.getElementById('chartDepartamentosMaisSolicitacoes').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (chartDepartamentosMaisSolicitacoes) {
                chartDepartamentosMaisSolicitacoes.destroy();
            }
            
            // Preparar dados para o gráfico
            const labels = dados.map(depto => depto.nome);
            const valores = dados.map(depto => depto.quantidade);
            const cores = [
                'rgba(74, 111, 165, 0.7)',
                'rgba(107, 140, 198, 0.7)',
                'rgba(56, 161, 105, 0.7)',
                'rgba(255, 126, 95, 0.7)',
                'rgba(214, 158, 46, 0.7)'
            ];
            
            // Criar novo gráfico
            chartDepartamentosMaisSolicitacoes = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Solicitações',
                        data: valores,
                        backgroundColor: cores,
                        borderColor: cores.map(cor => cor.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Atualizar gráfico de colaboradores que mais solicitam
        function atualizarGraficoColaboradoresMaisSolicitacoes(dados) {
            const ctx = document.getElementById('chartColaboradoresMaisSolicitacoes').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (chartColaboradoresMaisSolicitacoes) {
                chartColaboradoresMaisSolicitacoes.destroy();
            }
            
            // Preparar dados para o gráfico
            const labels = dados.map(colab => colab.nome);
            const valores = dados.map(colab => colab.quantidade);
            const cores = [
                'rgba(74, 111, 165, 0.7)',
                'rgba(107, 140, 198, 0.7)',
                'rgba(56, 161, 105, 0.7)',
                'rgba(255, 126, 95, 0.7)',
                'rgba(214, 158, 46, 0.7)'
            ];
            
            // Criar novo gráfico
            chartColaboradoresMaisSolicitacoes = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Solicitações',
                        data: valores,
                        backgroundColor: cores,
                        borderColor: cores.map(cor => cor.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        r: {
                            ticks: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Atualizar gráfico de distribuição por status
        function atualizarGraficoDistribuicaoStatus(dados) {
            const ctx = document.getElementById('chartDistribuicaoStatus').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (chartDistribuicaoStatus) {
                chartDistribuicaoStatus.destroy();
            }
            
            // Preparar dados para o gráfico
            const labels = ['Pendente', 'Realizado', 'Não Precisa'];
            const valores = [dados.pendente, dados.realizado, dados['nao-precisa']];
            const cores = [
                'rgba(214, 158, 46, 0.7)',  // Amarelo para pendente
                'rgba(56, 161, 105, 0.7)',   // Verde para realizado
                'rgba(160, 174, 192, 0.7)'   // Cinza para não precisa
            ];
            
            // Criar novo gráfico
            chartDistribuicaoStatus = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Quantidade',
                        data: valores,
                        backgroundColor: cores,
                        borderColor: cores.map(cor => cor.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Atualizar estatísticas do dashboard com dados filtrados
        function atualizarEstatisticasDashboard(dadosFiltrados) {
            // Se não há filtros aplicados, usar totais gerais
            const temFiltro = dashboardDataInicio.value || dashboardDataFim.value || 
                            dashboardEmpresa.value || dashboardDepartamento.value || 
                            dashboardItem.value;
            
            if (!temFiltro) {
                totalColaboradores.textContent = colaboradores.length;
                totalSolicitacoes.textContent = solicitacoes.length;
                
                // Atualizar solicitações pendentes
                const solicitacoesPendentes = solicitacoes.filter(s => s.status === 'pendente').length;
                dashboardMetrica.textContent = solicitacoesPendentes;
                dashboardDetalhe.textContent = `De ${solicitacoes.length} solicitações totais`;
                return;
            }
            
            // Atualizar com dados filtrados
            totalColaboradores.textContent = dadosFiltrados.colaboradoresFiltrados.length;
            totalSolicitacoes.textContent = dadosFiltrados.solicitacoesFiltradas.length;
            
            // Atualizar solicitações pendentes
            const solicitacoesPendentes = dadosFiltrados.solicitacoesFiltradas.filter(s => s.status === 'pendente').length;
            dashboardMetrica.textContent = solicitacoesPendentes;
            dashboardDetalhe.textContent = `De ${dadosFiltrados.solicitacoesFiltradas.length} solicitações totais`;
        }

        // Funções para manipular os dados
        function carregarEmpresas() {
            empresasBody.innerHTML = '';
            
            if (empresas.length === 0) {
                emptyEmpresas.style.display = 'block';
                return;
            }
            
            emptyEmpresas.style.display = 'none';
            
            empresas.forEach(empresa => {
                const count = solicitacoesPorEmpresa[empresa.id] || 0;
                const countClass = getSolicitacoesClass(count);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${empresa.nome}</td>
                    <td>
                        <div class="solicitacoes-cell">
                            <span class="solicitacoes-badge ${countClass}">
                                ${count}
                            </span>
                            <span class="solicitacoes-info">solicitações</span>
                        </div>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarEmpresa('${empresa.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirEmpresa('${empresa.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                empresasBody.appendChild(row);
            });
        }
        
        function carregarDepartamentos() {
            departamentosBody.innerHTML = '';
            
            if (departamentos.length === 0) {
                emptyDepartamentos.style.display = 'block';
                return;
            }
            
            emptyDepartamentos.style.display = 'none';
            
            departamentos.forEach(depto => {
                const count = solicitacoesPorDepartamento[depto.id] || 0;
                const countClass = getSolicitacoesClass(count);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${depto.nome}</td>
                    <td>
                        <div class="solicitacoes-cell">
                            <span class="solicitacoes-badge ${countClass}">
                                ${count}
                            </span>
                            <span class="solicitacoes-info">solicitações</span>
                        </div>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarDepartamento('${depto.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirDepartamento('${depto.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                departamentosBody.appendChild(row);
            });
        }

        function carregarColaboradores() {
            colaboradoresBody.innerHTML = '';
            
            if (colaboradores.length === 0) {
                emptyColaboradores.style.display = 'block';
                return;
            }
            
            emptyColaboradores.style.display = 'none';
            
            colaboradores.forEach(colaborador => {
                const dataAdmissao = new Date(colaborador.dataAdmissao);
                const dataFormatada = dataAdmissao.toLocaleDateString('pt-BR');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${colaborador.nome}</td>
                    <td>${colaborador.empresa}</td>
                    <td>${colaborador.departamento}</td>
                    <td>${dataFormatada}</td>
                    <td><span class="status-badge ${colaborador.status}">${colaborador.status}</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarColaborador('${colaborador.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirColaborador('${colaborador.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                colaboradoresBody.appendChild(row);
            });
        }

        function carregarItens() {
            itensBody.innerHTML = '';
            
            if (itens.length === 0) {
                emptyItens.style.display = 'block';
                return;
            }
            
            emptyItens.style.display = 'none';
            
            itens.forEach(item => {
                const count = solicitacoesPorItem[item.id] || 0;
                const countClass = getSolicitacoesClass(count);
                
                // Formatar tamanhos como tags
                let tamanhosHTML = '';
                if (item.tamanhos && item.tamanhos.length > 0) {
                    tamanhosHTML = '<div class="tamanhos-tags">';
                    item.tamanhos.forEach(tamanho => {
                        tamanhosHTML += `<span class="tamanho-tag">${tamanho.trim()}</span>`;
                    });
                    tamanhosHTML += '</div>';
                } else {
                    tamanhosHTML = '<span class="text-light">Nenhum tamanho cadastrado</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.nome}</td>
                    <td><span class="categoria-badge ${item.categoria}">${item.categoria}</span></td>
                    <td>${tamanhosHTML}</td>
                    <td>
                        <div class="solicitacoes-cell">
                            <span class="solicitacoes-badge ${countClass}">
                                ${count}
                            </span>
                            <span class="solicitacoes-info">solicitações</span>
                        </div>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarItem('${item.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirItem('${item.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                itensBody.appendChild(row);
            });
        }

        function carregarSolicitacoes() {
            solicitacoesBody.innerHTML = '';
            
            if (solicitacoes.length === 0) {
                emptySolicitacoes.style.display = 'block';
                return;
            }
            
            emptySolicitacoes.style.display = 'none';
            
            solicitacoes.forEach(solicitacao => {
                const dataSolicitacao = new Date(solicitacao.dataSolicitacao);
                const dataFormatada = dataSolicitacao.toLocaleDateString('pt-BR');
                
                // Formatar itens da solicitação no formato: 02 - Camisas Manga Curta - PP
                let itensHTML = '';
                if (solicitacao.itens && solicitacao.itens.length > 0) {
                    itensHTML = '<div class="itens-lista">';
                    solicitacao.itens.forEach((item) => {
                        // Formatar com zero à esquerda para quantidade
                        const quantidadeFormatada = item.quantidade.toString().padStart(2, '0');
                        itensHTML += `<div class="item-historico">${quantidadeFormatada} - ${item.item} - ${item.tamanho}</div>`;
                    });
                    itensHTML += '</div>';
                } else {
                    itensHTML = '<span class="text-light">Nenhum item</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${solicitacao.colaborador}</td>
                    <td>${solicitacao.empresa}</td>
                    <td>${solicitacao.departamento}</td>
                    <td>${itensHTML}</td>
                    <td>${dataFormatada}</td>
                    <td>
                        <div class="status-cell">
                            <span class="status-solicitacao-badge ${solicitacao.status}">${solicitacao.status}</span>
                            <div class="status-actions">
                                <button class="status-btn pendente" onclick="atualizarStatusSolicitacao('${solicitacao.id}', 'pendente')" title="Marcar como Pendente">
                                    <i class="fas fa-clock"></i>
                                </button>
                                <button class="status-btn realizado" onclick="atualizarStatusSolicitacao('${solicitacao.id}', 'realizado')" title="Marcar como Realizado">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="status-btn nao-precisa" onclick="atualizarStatusSolicitacao('${solicitacao.id}', 'nao-precisa')" title="Marcar como Não Precisa">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarSolicitacao('${solicitacao.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirSolicitacao('${solicitacao.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                solicitacoesBody.appendChild(row);
            });
        }

        // Funções para adicionar dados no Firebase
        async function adicionarEmpresa(nome) {
            try {
                if (!db) {
                    throw new Error("Firebase não inicializado");
                }
                
                console.log(`💾 Salvando empresa: ${nome}`);
                
                const docRef = await db.collection('empresas').add({
                    nome: nome.trim(),
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log(`✅ Empresa salva com ID: ${docRef.id}`);
                adicionarAtividade(`Empresa "${nome}" cadastrada com sucesso`);
                return docRef.id;
            } catch (error) {
                console.error('❌ Erro ao adicionar empresa:', error);
                alert('❌ Erro ao salvar empresa. Verifique sua conexão com a internet.');
                
                const novaEmpresa = {
                    id: 'temp-' + Date.now(),
                    nome: nome.trim(),
                    criadoEm: new Date()
                };
                empresas.unshift(novaEmpresa);
                calcularSolicitacoesPorEmpresa();
                carregarEmpresas();
                atualizarFiltrosColaboradores();
                atualizarFiltrosSolicitacoes();
                atualizarSelectsModalColaborador();
                atualizarSelectColaboradoresSolicitacao();
                atualizarFiltrosRelatorios();
                atualizarFiltrosDashboard();
                atualizarEstatisticas();
                adicionarAtividade(`Empresa "${nome}" salva localmente (modo offline)`);
                
                return null;
            }
        }
        
        async function adicionarDepartamento(nome) {
            try {
                if (!db) {
                    throw new Error("Firebase não inicializado");
                }
                
                console.log(`💾 Salvando departamento: ${nome}`);
                
                await db.collection('departamentos').add({
                    nome: nome.trim(),
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log(`✅ Departamento salvo com sucesso`);
                adicionarAtividade(`Departamento "${nome}" cadastrado com sucesso`);
                return true;
            } catch (error) {
                console.error('❌ Erro ao adicionar departamento:', error);
                alert('❌ Erro ao salvar departamento. Verifique sua conexão com a internet.');
                
                const novoDepartamento = {
                    id: 'temp-' + Date.now(),
                    nome: nome.trim(),
                    criadoEm: new Date()
                };
                departamentos.unshift(novoDepartamento);
                calcularSolicitacoesPorDepartamento();
                carregarDepartamentos();
                atualizarFiltrosColaboradores();
                atualizarFiltrosSolicitacoes();
                atualizarSelectsModalColaborador();
                atualizarEstatisticas();
                atualizarFiltrosDashboard();
                adicionarAtividade(`Departamento "${nome}" salvo localmente (modo offline)`);
                
                return false;
            }
        }

        async function adicionarColaborador(colaboradorData) {
            try {
                if (!db) {
                    throw new Error("Firebase não inicializado");
                }
                
                console.log(`💾 Salvando colaborador: ${colaboradorData.nome}`);
                
                const empresaSelecionada = empresas.find(e => e.id === colaboradorData.empresaId);
                const departamentoSelecionado = departamentos.find(d => d.id === colaboradorData.departamentoId);
                
                // CORREÇÃO: Criar data sem ajuste de fuso horário
                const dataAdmissao = new Date(colaboradorData.dataAdmissao);
                // Adicionar um dia para compensar o fuso horário (ajuste correto)
                dataAdmissao.setDate(dataAdmissao.getDate() + 1);
                
                const docRef = await db.collection('colaboradores').add({
                    nome: colaboradorData.nome.trim(),
                    empresaId: colaboradorData.empresaId,
                    empresa: empresaSelecionada ? empresaSelecionada.nome : '',
                    departamentoId: colaboradorData.departamentoId,
                    departamento: departamentoSelecionado ? departamentoSelecionado.nome : '',
                    dataAdmissao: firebase.firestore.Timestamp.fromDate(dataAdmissao),
                    status: colaboradorData.status,
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log(`✅ Colaborador salvo com ID: ${docRef.id}`);
                adicionarAtividade(`Colaborador "${colaboradorData.nome}" cadastrado com sucesso`);
                return docRef.id;
            } catch (error) {
                console.error('❌ Erro ao adicionar colaborador:', error);
                alert('❌ Erro ao salvar colaborador. Verifique sua conexão com a internet.');
                
                const empresaSelecionada = empresas.find(e => e.id === colaboradorData.empresaId);
                const departamentoSelecionado = departamentos.find(d => d.id === colaboradorData.departamentoId);
                
                // CORREÇÃO: Criar data sem ajuste de fuso horário
                const dataAdmissao = new Date(colaboradorData.dataAdmissao);
                
                const novoColaborador = {
                    id: 'temp-' + Date.now(),
                    nome: colaboradorData.nome.trim(),
                    empresaId: colaboradorData.empresaId,
                    empresa: empresaSelecionada ? empresaSelecionada.nome : '',
                    departamentoId: colaboradorData.departamentoId,
                    departamento: departamentoSelecionado ? departamentoSelecionado.nome : '',
                    dataAdmissao: dataAdmissao,
                    status: colaboradorData.status,
                    criadoEm: new Date()
                };
                
                colaboradores.unshift(novoColaborador);
                carregarColaboradores();
                atualizarSelectColaboradoresSolicitacao();
                atualizarEstatisticas();
                atualizarFiltrosDashboard();
                adicionarAtividade(`Colaborador "${colaboradorData.nome}" salvo localmente (modo offline)`);
                
                return null;
            }
        }

        async function adicionarItem(itemData) {
            try {
                if (!db) {
                    throw new Error("Firebase não inicializado");
                }
                
                console.log(`💾 Salvando item: ${itemData.nome}`);
                
                // Processar tamanhos (separar por vírgula e remover espaços extras)
                let tamanhosArray = [];
                if (itemData.tamanhos && itemData.tamanhos.trim() !== '') {
                    tamanhosArray = itemData.tamanhos.split(',')
                        .map(t => t.trim())
                        .filter(t => t !== '');
                }
                
                const docRef = await db.collection('itens').add({
                    nome: itemData.nome.trim(),
                    categoria: itemData.categoria,
                    tamanhos: tamanhosArray,
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log(`✅ Item salvo com ID: ${docRef.id}`);
                adicionarAtividade(`Item "${itemData.nome}" cadastrado com sucesso`);
                return docRef.id;
            } catch (error) {
                console.error('❌ Erro ao adicionar item:', error);
                alert('❌ Erro ao salvar item. Verifique sua conexão com a internet.');
                
                // Processar tamanhos
                let tamanhosArray = [];
                if (itemData.tamanhos && itemData.tamanhos.trim() !== '') {
                    tamanhosArray = itemData.tamanhos.split(',')
                        .map(t => t.trim())
                        .filter(t => t !== '');
                }
                
                const novoItem = {
                    id: 'temp-' + Date.now(),
                    nome: itemData.nome.trim(),
                    categoria: itemData.categoria,
                    tamanhos: tamanhosArray,
                    criadoEm: new Date()
                };
                
                itens.unshift(novoItem);
                calcularSolicitacoesPorItem();
                carregarItens();
                atualizarItensSelectSolicitacao();
                atualizarEstatisticas();
                atualizarFiltrosDashboard();
                adicionarAtividade(`Item "${itemData.nome}" salvo localmente (modo offline)`);
                
                return null;
            }
        }

        async function adicionarSolicitacao(solicitacaoData) {
            try {
                if (!db) {
                    throw new Error("Firebase não inicializado");
                }
                
                console.log(`💾 Salvando solicitação: ${solicitacaoData.colaboradorId}`);
                
                const colaboradorSelecionado = colaboradores.find(c => c.id === solicitacaoData.colaboradorId);
                
                // CORREÇÃO: Criar data sem ajuste de fuso horário
                const dataSolicitacao = new Date(solicitacaoData.dataSolicitacao);
                // Adicionar um dia para compensar o fuso horário
                dataSolicitacao.setDate(dataSolicitacao.getDate() + 1);
                
                const docRef = await db.collection('solicitacoes').add({
                    colaboradorId: solicitacaoData.colaboradorId,
                    colaborador: colaboradorSelecionado ? colaboradorSelecionado.nome : '',
                    empresaId: colaboradorSelecionado ? colaboradorSelecionado.empresaId : '',
                    empresa: colaboradorSelecionado ? colaboradorSelecionado.empresa : '',
                    departamentoId: colaboradorSelecionado ? colaboradorSelecionado.departamentoId : '',
                    departamento: colaboradorSelecionado ? colaboradorSelecionado.departamento : '',
                    itens: solicitacaoData.itens,
                    dataSolicitacao: firebase.firestore.Timestamp.fromDate(dataSolicitacao),
                    status: solicitacaoData.status,
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log(`✅ Solicitação salva com ID: ${docRef.id}`);
                adicionarAtividade(`Solicitação para "${colaboradorSelecionado.nome}" cadastrada com sucesso`);
                return docRef.id;
            } catch (error) {
                console.error('❌ Erro ao adicionar solicitação:', error);
                alert('❌ Erro ao salvar solicitação. Verifique sua conexão com a internet.');
                
                const colaboradorSelecionado = colaboradores.find(c => c.id === solicitacaoData.colaboradorId);
                
                // CORREÇÃO: Criar data sem ajuste de fuso horário
                const dataSolicitacao = new Date(solicitacaoData.dataSolicitacao);
                
                const novaSolicitacao = {
                    id: 'temp-' + Date.now(),
                    colaboradorId: solicitacaoData.colaboradorId,
                    colaborador: colaboradorSelecionado ? colaboradorSelecionado.nome : '',
                    empresaId: colaboradorSelecionado ? colaboradorSelecionado.empresaId : '',
                    empresa: colaboradorSelecionado ? colaboradorSelecionado.empresa : '',
                    departamentoId: colaboradorSelecionado ? colaboradorSelecionado.departamentoId : '',
                    departamento: colaboradorSelecionado ? colaboradorSelecionado.departamento : '',
                    itens: solicitacaoData.itens,
                    dataSolicitacao: dataSolicitacao,
                    status: solicitacaoData.status,
                    criadoEm: new Date()
                };
                
                solicitacoes.unshift(novaSolicitacao);
                calcularSolicitacoesPorEmpresa();
                calcularSolicitacoesPorDepartamento();
                calcularSolicitacoesPorItem();
                carregarSolicitacoes();
                carregarEmpresas();
                carregarDepartamentos();
                carregarItens();
                atualizarEstatisticas();
                atualizarGraficosDashboard();
                adicionarAtividade(`Solicitação salva localmente (modo offline)`);
                
                return null;
            }
        }

        // Atualizar status da solicitação (SEM CONFIRMAÇÃO)
        async function atualizarStatusSolicitacao(id, novoStatus) {
            const solicitacao = solicitacoes.find(s => s.id === id);
            if (!solicitacao) return;
            
            const statusAtual = solicitacao.status;
            
            if (statusAtual === novoStatus) {
                return;
            }
            
            // REMOVIDA A CONFIRMAÇÃO - APENAS ATUALIZA DIRETAMENTE
            try {
                if (!db) throw new Error("Firebase não inicializado");
                
                await db.collection('solicitacoes').doc(id).update({
                    status: novoStatus
                });
                
                adicionarAtividade(`Status da solicitação de "${solicitacao.colaborador}" alterado para "${novoStatus}"`);
                
                // Atualizar localmente também
                solicitacao.status = novoStatus;
                carregarSolicitacoes();
                atualizarGraficosDashboard();
                
            } catch (error) {
                console.error('❌ Erro ao atualizar status da solicitação:', error);
                alert('❌ Erro ao atualizar status. Tente novamente.');
            }
        }

        // Funções para editar dados no Firebase
        async function editarEmpresa(id) {
            const empresa = empresas.find(e => e.id === id);
            if (!empresa) return;
            
            nomeEmpresaInput.value = empresa.nome;
            
            abrirModalEmpresa();
            
            const formSubmitHandler = async function(e) {
                e.preventDefault();
                const nome = nomeEmpresaInput.value.trim();
                if (nome) {
                    try {
                        if (!db) throw new Error("Firebase não inicializado");
                        
                        await db.collection('empresas').doc(id).update({
                            nome: nome
                        });
                        
                        adicionarAtividade(`Empresa "${nome}" atualizada com sucesso`);
                        fecharModalEmpresa();
                    } catch (error) {
                        console.error('❌ Erro ao atualizar empresa:', error);
                        alert('❌ Erro ao atualizar empresa. Tente novamente.');
                    }
                }
            };
            
            formEmpresa.removeEventListener('submit', formEmpresa.submitHandler);
            formEmpresa.submitHandler = formSubmitHandler;
            formEmpresa.addEventListener('submit', formSubmitHandler);
        }
        
        async function editarDepartamento(id) {
            const departamento = departamentos.find(d => d.id === id);
            if (!departamento) return;
            
            nomeDepartamentoInput.value = departamento.nome;
            
            abrirModalDepartamento();
            
            const formSubmitHandler = async function(e) {
                e.preventDefault();
                const nome = nomeDepartamentoInput.value.trim();
                if (nome) {
                    try {
                        if (!db) throw new Error("Firebase não inicializado");
                        
                        await db.collection('departamentos').doc(id).update({
                            nome: nome
                        });
                        
                        adicionarAtividade(`Departamento "${nome}" atualizado com sucesso`);
                        fecharModalDepartamento();
                    } catch (error) {
                        console.error('❌ Erro ao atualizar departamento:', error);
                        alert('❌ Erro ao atualizar departamento. Tente novamente.');
                    }
                }
            };
            
            formDepartamento.removeEventListener('submit', formDepartamento.submitHandler);
            formDepartamento.submitHandler = formSubmitHandler;
            formDepartamento.addEventListener('submit', formSubmitHandler);
        }

        async function editarColaborador(id) {
            const colaborador = colaboradores.find(c => c.id === id);
            if (!colaborador) return;
            
            nomeColaboradorInput.value = colaborador.nome;
            empresaColaboradorSelect.value = colaborador.empresaId;
            departamentoColaboradorSelect.value = colaborador.departamentoId;
            
            // CORREÇÃO: Formatar a data corretamente sem ajuste de fuso horário
            const dataAdmissao = new Date(colaborador.dataAdmissao);
            // Subtrair um dia para exibir a data correta (compensação do fuso)
            dataAdmissao.setDate(dataAdmissao.getDate() - 1);
            const dataFormatada = dataAdmissao.toISOString().split('T')[0];
            dataAdmissaoColaboradorInput.value = dataFormatada;
            
            statusColaboradorSelect.value = colaborador.status;
            
            modalColaboradorTitle.textContent = 'Editar Colaborador';
            saveColaboradorBtn.textContent = 'Atualizar Colaborador';
            editandoColaboradorId = id;
            
            abrirModalColaborador();
            atualizarSelectsModalColaborador();
        }

        async function editarItem(id) {
            const item = itens.find(i => i.id === id);
            if (!item) return;
            
            nomeItemInput.value = item.nome;
            categoriaItemSelect.value = item.categoria;
            
            // Converter array de tamanhos para string separada por vírgula
            if (item.tamanhos && item.tamanhos.length > 0) {
                tamanhosItemTextarea.value = item.tamanhos.join(', ');
            } else {
                tamanhosItemTextarea.value = '';
            }
            
            modalItemTitle.textContent = 'Editar Item';
            saveItemBtn.textContent = 'Atualizar Item';
            editandoItemId = id;
            
            abrirModalItem();
        }

        async function editarSolicitacao(id) {
            const solicitacao = solicitacoes.find(s => s.id === id);
            if (!solicitacao) return;
            
            // Preencher campos do formulário
            colaboradorSolicitacaoSelect.value = solicitacao.colaboradorId;
            empresaSolicitacaoInput.value = solicitacao.empresa;
            departamentoSolicitacaoInput.value = solicitacao.departamento;
            
            // Limpar container de itens
            itensSolicitacaoContainer.innerHTML = '';
            
            // Adicionar itens da solicitação
            if (solicitacao.itens && solicitacao.itens.length > 0) {
                solicitacao.itens.forEach((item, index) => {
                    adicionarItemSolicitacao();
                    
                    // Preencher os selects após um breve delay para garantir que o DOM foi atualizado
                    setTimeout(() => {
                        const itemDivs = itensSolicitacaoContainer.querySelectorAll('.item-solicitacao');
                        const currentItemDiv = itemDivs[index];
                        
                        if (currentItemDiv) {
                            const itemSelect = currentItemDiv.querySelector('.item-select');
                            const tamanhoSelect = currentItemDiv.querySelector('.tamanho-select');
                            const quantidadeInput = currentItemDiv.querySelector('.quantidade-input');
                            
                            if (itemSelect && tamanhoSelect && quantidadeInput) {
                                itemSelect.value = item.itemId;
                                atualizarTamanhosSelect(itemSelect);
                                
                                // Definir tamanho após um pequeno delay para garantir que os tamanhos foram carregados
                                setTimeout(() => {
                                    tamanhoSelect.value = item.tamanho;
                                }, 100);
                                
                                quantidadeInput.value = item.quantidade;
                            }
                        }
                    }, 100);
                });
            } else {
                // Adicionar um item vazio se não houver itens
                adicionarItemSolicitacao();
            }
            
            // Preencher data e status
            const dataSolicitacao = new Date(solicitacao.dataSolicitacao);
            // Subtrair um dia para exibir a data correta (compensação do fuso)
            dataSolicitacao.setDate(dataSolicitacao.getDate() - 1);
            const dataFormatada = dataSolicitacao.toISOString().split('T')[0];
            dataSolicitacaoInput.value = dataFormatada;
            statusSolicitacaoSelect.value = solicitacao.status;
            
            modalSolicitacaoTitle.textContent = 'Editar Solicitação';
            saveSolicitacaoBtn.textContent = 'Atualizar Solicitação';
            editandoSolicitacaoId = id;
            
            abrirModalSolicitacao();
            atualizarSelectColaboradoresSolicitacao();
            atualizarItensSelectSolicitacao();
        }

        // Funções para excluir dados do Firebase
        async function excluirEmpresa(id) {
            const empresa = empresas.find(e => e.id === id);
            if (!empresa) return;
            
            const countSolicitacoes = solicitacoesPorEmpresa[id] || 0;
            if (countSolicitacoes > 0) {
                if (!confirm(`A empresa "${empresa.nome}" tem ${countSolicitacoes} solicitaç${countSolicitacoes === 1 ? 'ão' : 'ões'} vinculadas. Tem certeza que deseja excluir?`)) {
                    return;
                }
            } else {
                if (!confirm(`Tem certeza que deseja excluir a empresa "${empresa.nome}"?`)) {
                    return;
                }
            }
            
            try {
                if (!db) throw new Error("Firebase não inicializado");
                
                await db.collection('empresas').doc(id).delete();
                adicionarAtividade(`Empresa "${empresa.nome}" excluída com sucesso`);
            } catch (error) {
                console.error('❌ Erro ao excluir empresa:', error);
                alert('❌ Erro ao excluir empresa. Tente novamente.');
            }
        }
        
        async function excluirDepartamento(id) {
            const departamento = departamentos.find(d => d.id === id);
            if (!departamento) return;
            
            const countSolicitacoes = solicitacoesPorDepartamento[id] || 0;
            if (countSolicitacoes > 0) {
                if (!confirm(`O departamento "${departamento.nome}" tem ${countSolicitacoes} solicitaç${countSolicitacoes === 1 ? 'ão' : 'ões'} vinculadas. Tem certeza que deseja excluir?`)) {
                    return;
                }
            } else {
                if (!confirm(`Tem certeza que deseja excluir o departamento "${departamento.nome}"?`)) {
                    return;
                }
            }
            
            try {
                if (!db) throw new Error("Firebase não inicializado");
                
                await db.collection('departamentos').doc(id).delete();
                adicionarAtividade(`Departamento "${departamento.nome}" excluído com sucesso`);
            } catch (error) {
                console.error('❌ Erro ao excluir departamento:', error);
                alert('❌ Erro ao excluir departamento. Tente novamente.');
            }
        }

        async function excluirColaborador(id) {
            const colaborador = colaboradores.find(c => c.id === id);
            if (!colaborador) return;
            
            // Verificar se o colaborador tem solicitações
            const countSolicitacoes = solicitacoes.filter(s => s.colaboradorId === id).length;
            if (countSolicitacoes > 0) {
                if (!confirm(`O colaborador "${colaborador.nome}" tem ${countSolicitacoes} solicitaç${countSolicitacoes === 1 ? 'ão' : 'ões'} vinculadas. Tem certeza que deseja excluir?`)) {
                    return;
                }
            } else {
                if (!confirm(`Tem certeza que deseja excluir o colaborador "${colaborador.nome}"?`)) {
                    return;
                }
            }
            
            try {
                if (!db) throw new Error("Firebase não inicializado");
                
                await db.collection('colaboradores').doc(id).delete();
                adicionarAtividade(`Colaborador "${colaborador.nome}" excluído com sucesso`);
            } catch (error) {
                console.error('❌ Erro ao excluir colaborador:', error);
                alert('❌ Erro ao excluir colaborador. Tente novamente.');
            }
        }

        async function excluirItem(id) {
            const item = itens.find(i => i.id === id);
            if (!item) return;
            
            // Verificar se o item tem solicitações
            const countSolicitacoes = solicitacoes.filter(s => 
                s.itens && s.itens.some(i => i.itemId === id)
            ).length;
            
            if (countSolicitacoes > 0) {
                if (!confirm(`O item "${item.nome}" tem ${countSolicitacoes} solicitaç${countSolicitacoes === 1 ? 'ão' : 'ões'} vinculadas. Tem certeza que deseja excluir?`)) {
                    return;
                }
            } else {
                if (!confirm(`Tem certeza que deseja excluir o item "${item.nome}"?`)) {
                    return;
                }
            }
            
            try {
                if (!db) throw new Error("Firebase não inicializado");
                
                await db.collection('itens').doc(id).delete();
                adicionarAtividade(`Item "${item.nome}" excluído com sucesso`);
            } catch (error) {
                console.error('❌ Erro ao excluir item:', error);
                alert('❌ Erro ao excluir item. Tente novamente.');
            }
        }

        async function excluirSolicitacao(id) {
            const solicitacao = solicitacoes.find(s => s.id === id);
            if (!solicitacao) return;
            
            if (!confirm(`Tem certeza que deseja excluir a solicitação do colaborador "${solicitacao.colaborador}"?`)) {
                return;
            }
            
            try {
                if (!db) throw new Error("Firebase não inicializado");
                
                await db.collection('solicitacoes').doc(id).delete();
                adicionarAtividade(`Solicitação excluída com sucesso`);
            } catch (error) {
                console.error('❌ Erro ao excluir solicitação:', error);
                alert('❌ Erro ao excluir solicitação. Tente novamente.');
            }
        }

        // Funções para filtrar dados
        function filtrarDados() {
            const empresaFiltro = filterEmpresa.value.toLowerCase();
            const departamentoFiltro = filterDepartamento.value.toLowerCase();
            
            let empresasFiltradas = empresas;
            if (empresaFiltro) {
                empresasFiltradas = empresas.filter(e => 
                    e.nome.toLowerCase().includes(empresaFiltro)
                );
            }
            
            let departamentosFiltrados = departamentos;
            if (departamentoFiltro) {
                departamentosFiltrados = departamentos.filter(d => 
                    d.nome.toLowerCase().includes(departamentoFiltro)
                );
            }
            
            atualizarTabelaFiltrada(empresasFiltradas, departamentosFiltrados);
        }
        
        function filtrarColaboradores() {
            const nomeFiltro = filterNomeColaborador.value.toLowerCase();
            const statusFiltro = filterStatusColaborador.value;
            const empresaFiltro = filterEmpresaColaborador.value;
            const departamentoFiltro = filterDepartamentoColaborador.value;
            
            let colaboradoresFiltrados = colaboradores;
            
            if (nomeFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => 
                    c.nome.toLowerCase().includes(nomeFiltro)
                );
            }
            
            if (statusFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => 
                    c.status === statusFiltro
                );
            }
            
            if (empresaFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => 
                    c.empresaId === empresaFiltro
                );
            }
            
            if (departamentoFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => 
                    c.departamentoId === departamentoFiltro
                );
            }
            
            atualizarTabelaColaboradoresFiltrada(colaboradoresFiltrados);
        }

        function filtrarItens() {
            const nomeFiltro = filterNomeItem.value.toLowerCase();
            const categoriaFiltro = filterCategoriaItem.value;
            
            let itensFiltrados = itens;
            
            if (nomeFiltro) {
                itensFiltrados = itensFiltrados.filter(i => 
                    i.nome.toLowerCase().includes(nomeFiltro)
                );
            }
            
            if (categoriaFiltro) {
                itensFiltrados = itensFiltrados.filter(i => 
                    i.categoria === categoriaFiltro
                );
            }
            
            atualizarTabelaItensFiltrada(itensFiltrados);
        }

        function filtrarSolicitacoes() {
            const colaboradorFiltro = filterColaboradorSolicitacao.value.toLowerCase();
            const empresaFiltro = filterEmpresaSolicitacao.value;
            const departamentoFiltro = filterDepartamentoSolicitacao.value;
            const itemFiltro = filterItemSolicitacao.value.toLowerCase();
            const statusFiltro = filterStatusSolicitacao.value;
            const dataInicioFiltro = filterDataInicioSolicitacao.value;
            const dataFimFiltro = filterDataFimSolicitacao.value;
            
            let solicitacoesFiltradas = solicitacoes;
            
            // Filtrar por colaborador
            if (colaboradorFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.colaborador.toLowerCase().includes(colaboradorFiltro)
                );
            }
            
            // Filtrar por empresa
            if (empresaFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.empresaId === empresaFiltro
                );
            }
            
            // Filtrar por departamento
            if (departamentoFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.departamentoId === departamentoFiltro
                );
            }
            
            // Filtrar por item
            if (itemFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.itens && s.itens.some(i => i.item.toLowerCase().includes(itemFiltro))
                );
            }
            
            // Filtrar por status
            if (statusFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.status === statusFiltro
                );
            }
            
            // Filtrar por período
            if (dataInicioFiltro) {
                const dataInicio = new Date(dataInicioFiltro);
                dataInicio.setDate(dataInicio.getDate() - 1); // Ajustar para o fuso horário
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => {
                    const dataSolicitacao = new Date(s.dataSolicitacao);
                    return dataSolicitacao >= dataInicio;
                });
            }
            
            if (dataFimFiltro) {
                const dataFim = new Date(dataFimFiltro);
                dataFim.setDate(dataFim.getDate()); // Não ajustar para manter o fim do dia correto
                dataFim.setHours(23, 59, 59, 999); // Fim do dia
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => {
                    const dataSolicitacao = new Date(s.dataSolicitacao);
                    return dataSolicitacao <= dataFim;
                });
            }
            
            atualizarTabelaSolicitacoesFiltrada(solicitacoesFiltradas);
        }
        
        function atualizarTabelaFiltrada(empresasFiltradas, departamentosFiltrados) {
            empresasBody.innerHTML = '';
            
            if (empresasFiltradas.length === 0) {
                emptyEmpresas.style.display = 'block';
            } else {
                emptyEmpresas.style.display = 'none';
                
                empresasFiltradas.forEach(empresa => {
                    const count = solicitacoesPorEmpresa[empresa.id] || 0;
                    const countClass = getSolicitacoesClass(count);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${empresa.nome}</td>
                        <td>
                            <div class="solicitacoes-cell">
                                <span class="solicitacoes-badge ${countClass}">
                                    ${count}
                                </span>
                                <span class="solicitacoes-info">solicitações</span>
                            </div>
                        </td>
                        <td class="actions-cell">
                            <button class="action-btn" onclick="editarEmpresa('${empresa.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" onclick="excluirEmpresa('${empresa.id}')" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    empresasBody.appendChild(row);
                });
            }
            
            departamentosBody.innerHTML = '';
            
            if (departamentosFiltrados.length === 0) {
                emptyDepartamentos.style.display = 'block';
            } else {
                emptyDepartamentos.style.display = 'none';
                
                departamentosFiltrados.forEach(depto => {
                    const count = solicitacoesPorDepartamento[depto.id] || 0;
                    const countClass = getSolicitacoesClass(count);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${depto.nome}</td>
                        <td>
                            <div class="solicitacoes-cell">
                                <span class="solicitacoes-badge ${countClass}">
                                    ${count}
                                </span>
                                <span class="solicitacoes-info">solicitações</span>
                            </div>
                        </td>
                        <td class="actions-cell">
                            <button class="action-btn" onclick="editarDepartamento('${depto.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" onclick="excluirDepartamento('${depto.id}')" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    departamentosBody.appendChild(row);
                });
            }
        }

        function atualizarTabelaColaboradoresFiltrada(colaboradoresFiltrados) {
            colaboradoresBody.innerHTML = '';
            
            if (colaboradoresFiltrados.length === 0) {
                emptyColaboradores.style.display = 'block';
                return;
            }
            
            emptyColaboradores.style.display = 'none';
            
            colaboradoresFiltrados.forEach(colaborador => {
                const dataAdmissao = new Date(colaborador.dataAdmissao);
                const dataFormatada = dataAdmissao.toLocaleDateString('pt-BR');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${colaborador.nome}</td>
                    <td>${colaborador.empresa}</td>
                    <td>${colaborador.departamento}</td>
                    <td>${dataFormatada}</td>
                    <td><span class="status-badge ${colaborador.status}">${colaborador.status}</span></td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarColaborador('${colaborador.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirColaborador('${colaborador.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                colaboradoresBody.appendChild(row);
            });
        }

        function atualizarTabelaItensFiltrada(itensFiltrados) {
            itensBody.innerHTML = '';
            
            if (itensFiltrados.length === 0) {
                emptyItens.style.display = 'block';
                return;
            }
            
            emptyItens.style.display = 'none';
            
            itensFiltrados.forEach(item => {
                const count = solicitacoesPorItem[item.id] || 0;
                const countClass = getSolicitacoesClass(count);
                
                let tamanhosHTML = '';
                if (item.tamanhos && item.tamanhos.length > 0) {
                    tamanhosHTML = '<div class="tamanhos-tags">';
                    item.tamanhos.forEach(tamanho => {
                        tamanhosHTML += `<span class="tamanho-tag">${tamanho.trim()}</span>`;
                    });
                    tamanhosHTML += '</div>';
                } else {
                    tamanhosHTML = '<span class="text-light">Nenhum tamanho cadastrado</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.nome}</td>
                    <td><span class="categoria-badge ${item.categoria}">${item.categoria}</span></td>
                    <td>${tamanhosHTML}</td>
                    <td>
                        <div class="solicitacoes-cell">
                            <span class="solicitacoes-badge ${countClass}">
                                ${count}
                            </span>
                            <span class="solicitacoes-info">solicitações</span>
                        </div>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarItem('${item.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirItem('${item.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                itensBody.appendChild(row);
            });
        }

        function atualizarTabelaSolicitacoesFiltrada(solicitacoesFiltradas) {
            solicitacoesBody.innerHTML = '';
            
            if (solicitacoesFiltradas.length === 0) {
                emptySolicitacoes.style.display = 'block';
                return;
            }
            
            emptySolicitacoes.style.display = 'none';
            
            solicitacoesFiltradas.forEach(solicitacao => {
                const dataSolicitacao = new Date(solicitacao.dataSolicitacao);
                const dataFormatada = dataSolicitacao.toLocaleDateString('pt-BR');
                
                // Formatar itens da solicitação no formato: 02 - Camisas Manga Curta - PP
                let itensHTML = '';
                if (solicitacao.itens && solicitacao.itens.length > 0) {
                    itensHTML = '<div class="itens-lista">';
                    solicitacao.itens.forEach((item) => {
                        // Formatar com zero à esquerda para quantidade
                        const quantidadeFormatada = item.quantidade.toString().padStart(2, '0');
                        itensHTML += `<div class="item-historico">${quantidadeFormatada} - ${item.item} - ${item.tamanho}</div>`;
                    });
                    itensHTML += '</div>';
                } else {
                    itensHTML = '<span class="text-light">Nenhum item</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${solicitacao.colaborador}</td>
                    <td>${solicitacao.empresa}</td>
                    <td>${solicitacao.departamento}</td>
                    <td>${itensHTML}</td>
                    <td>${dataFormatada}</td>
                    <td>
                        <div class="status-cell">
                            <span class="status-solicitacao-badge ${solicitacao.status}">${solicitacao.status}</span>
                            <div class="status-actions">
                                <button class="status-btn pendente" onclick="atualizarStatusSolicitacao('${solicitacao.id}', 'pendente')" title="Marcar como Pendente">
                                    <i class="fas fa-clock"></i>
                                </button>
                                <button class="status-btn realizado" onclick="atualizarStatusSolicitacao('${solicitacao.id}', 'realizado')" title="Marcar como Realizado">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="status-btn nao-precisa" onclick="atualizarStatusSolicitacao('${solicitacao.id}', 'nao-precisa')" title="Marcar como Não Precisa">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" onclick="editarSolicitacao('${solicitacao.id}')" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="excluirSolicitacao('${solicitacao.id}')" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                solicitacoesBody.appendChild(row);
            });
        }

        // Adicionar novo item à solicitação (SIMPLIFICADO)
        function adicionarItemSolicitacao() {
            const itemCount = itensSolicitacaoContainer.querySelectorAll('.item-solicitacao').length + 1;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-solicitacao';
            itemDiv.innerHTML = `
                <div class="item-row">
                    <div class="item-field">
                        <label>Item</label>
                        <select class="form-select item-select" onchange="atualizarTamanhosSelect(this)" required>
                            <option value="">Selecione um item</option>
                            ${itens.map(i => `<option value="${i.id}">${i.nome}</option>`).join('')}
                        </select>
                    </div>
                    <div class="item-field">
                        <label>Tamanho</label>
                        <select class="form-select tamanho-select" required>
                            <option value="">Selecione um tamanho</option>
                        </select>
                    </div>
                    <div class="item-field">
                        <label>Quantidade</label>
                        <input type="number" class="form-input quantidade-input" min="1" value="1" required>
                    </div>
                    <button type="button" class="remover-item-btn" onclick="removerItemSolicitacao(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            itensSolicitacaoContainer.appendChild(itemDiv);
        }

        // Remover item da solicitação
        function removerItemSolicitacao(button) {
            const itemDiv = button.closest('.item-solicitacao');
            if (itensSolicitacaoContainer.querySelectorAll('.item-solicitacao').length > 1) {
                itemDiv.remove();
            } else {
                alert('A solicitação deve ter pelo menos um item.');
            }
        }

        // Atualizar informações do colaborador selecionado
        function atualizarInfoColaborador() {
            const colaboradorId = colaboradorSolicitacaoSelect.value;
            const colaborador = colaboradores.find(c => c.id === colaboradorId);
            
            if (colaborador) {
                empresaSolicitacaoInput.value = colaborador.empresa;
                departamentoSolicitacaoInput.value = colaborador.departamento;
            } else {
                empresaSolicitacaoInput.value = '';
                departamentoSolicitacaoInput.value = '';
            }
        }

        // Funções para abrir/fechar modais
        function abrirModalEmpresa() {
            modalEmpresa.classList.add('active');
            nomeEmpresaInput.focus();
            nomeEmpresaInput.value = '';
            
            const defaultSubmitHandler = async function(e) {
                e.preventDefault();
                const nome = nomeEmpresaInput.value.trim();
                if (nome) {
                    console.log('💾 Salvando empresa...');
                    const success = await adicionarEmpresa(nome);
                    if (success) {
                        fecharModalEmpresa();
                    }
                }
            };
            
            formEmpresa.removeEventListener('submit', formEmpresa.submitHandler);
            formEmpresa.submitHandler = defaultSubmitHandler;
            formEmpresa.addEventListener('submit', defaultSubmitHandler);
        }
        
        function fecharModalEmpresa() {
            modalEmpresa.classList.remove('active');
            formEmpresa.reset();
        }
        
        function abrirModalDepartamento() {
            modalDepartamento.classList.add('active');
            nomeDepartamentoInput.focus();
            nomeDepartamentoInput.value = '';
            
            const defaultSubmitHandler = async function(e) {
                e.preventDefault();
                const nome = nomeDepartamentoInput.value.trim();
                if (nome) {
                    console.log('💾 Salvando departamento...');
                    const success = await adicionarDepartamento(nome);
                    if (success) {
                        fecharModalDepartamento();
                    }
                }
            };
            
            formDepartamento.removeEventListener('submit', formDepartamento.submitHandler);
            formDepartamento.submitHandler = defaultSubmitHandler;
            formDepartamento.addEventListener('submit', defaultSubmitHandler);
        }
        
        function fecharModalDepartamento() {
            modalDepartamento.classList.remove('active');
            formDepartamento.reset();
        }
        
        function abrirModalColaborador() {
            modalColaborador.classList.add('active');
            nomeColaboradorInput.focus();
            
            if (!dataAdmissaoColaboradorInput.value) {
                const hoje = new Date();
                const dataFormatada = hoje.toISOString().split('T')[0];
                dataAdmissaoColaboradorInput.value = dataFormatada;
            }
            
            atualizarSelectsModalColaborador();
            
            if (!editandoColaboradorId) {
                formColaborador.reset();
                modalColaboradorTitle.textContent = 'Novo Colaborador';
                saveColaboradorBtn.textContent = 'Salvar Colaborador';
                
                const hoje = new Date();
                const dataFormatada = hoje.toISOString().split('T')[0];
                dataAdmissaoColaboradorInput.value = dataFormatada;
            }
        }
        
        function fecharModalColaborador() {
            modalColaborador.classList.remove('active');
            formColaborador.reset();
            editandoColaboradorId = null;
            modalColaboradorTitle.textContent = 'Novo Colaborador';
            saveColaboradorBtn.textContent = 'Salvar Colaborador';
        }

        function abrirModalItem() {
            modalItem.classList.add('active');
            nomeItemInput.focus();
            
            if (!editandoItemId) {
                formItem.reset();
                modalItemTitle.textContent = 'Novo Item';
                saveItemBtn.textContent = 'Salvar Item';
                categoriaItemSelect.value = 'uniforme';
                tamanhosItemTextarea.value = '';
            }
        }
        
        function fecharModalItem() {
            modalItem.classList.remove('active');
            formItem.reset();
            editandoItemId = null;
            modalItemTitle.textContent = 'Novo Item';
            saveItemBtn.textContent = 'Salvar Item';
        }

        function abrirModalSolicitacao() {
            modalSolicitacao.classList.add('active');
            
            if (!dataSolicitacaoInput.value) {
                const hoje = new Date();
                const dataFormatada = hoje.toISOString().split('T')[0];
                dataSolicitacaoInput.value = dataFormatada;
            }
            
            if (!editandoSolicitacaoId) {
                // Nova solicitação - garantir que haja pelo menos um item
                itensSolicitacaoContainer.innerHTML = '';
                adicionarItemSolicitacao();
                formSolicitacao.reset();
                modalSolicitacaoTitle.textContent = 'Nova Solicitação';
                saveSolicitacaoBtn.textContent = 'Salvar Solicitação';
                statusSolicitacaoSelect.value = 'pendente';
                
                const hoje = new Date();
                const dataFormatada = hoje.toISOString().split('T')[0];
                dataSolicitacaoInput.value = dataFormatada;
                
                // Atualizar selects de itens
                atualizarItensSelectSolicitacao();
            }
            
            // Atualizar informações do colaborador se já estiver selecionado
            if (colaboradorSolicitacaoSelect.value) {
                atualizarInfoColaborador();
            }
        }
        
        function fecharModalSolicitacao() {
            modalSolicitacao.classList.remove('active');
            formSolicitacao.reset();
            itensSolicitacaoContainer.innerHTML = '';
            editandoSolicitacaoId = null;
            modalSolicitacaoTitle.textContent = 'Nova Solicitação';
            saveSolicitacaoBtn.textContent = 'Salvar Solicitação';
        }

        // Função para mostrar página específica
        function mostrarPagina(paginaId) {
            console.log('📄 Mostrando página:', paginaId);
            
            Object.values(contentWrappers).forEach(wrapper => {
                wrapper.classList.remove('active');
            });
            
            navLinks.forEach(link => {
                if (link.getAttribute('data-page') === paginaId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            if (contentWrappers[paginaId]) {
                contentWrappers[paginaId].classList.add('active');
                
                const pageTitles = {
                    dashboard: 'Dashboard',
                    empresa: 'Empresa',
                    colaboradores: 'Colaboradores',
                    itens: 'Itens',
                    solicitacoes: 'Solicitações',
                    relatorios: 'Relatórios'
                };
                
                pageTitle.textContent = pageTitles[paginaId] || paginaId;
                
                // Se for dashboard, atualizar gráficos
                if (paginaId === 'dashboard') {
                    atualizarGraficosDashboard();
                }
            }
        }

        // FUNÇÕES PARA RELATÓRIOS
        function inicializarRelatorios() {
            // Inicializar seleção de tipos de relatório
            const reportCards = document.querySelectorAll('.report-option-card');
            reportCards.forEach(card => {
                card.addEventListener('click', function() {
                    const reportType = this.getAttribute('data-report-type');
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        const index = selectedReportTypes.indexOf(reportType);
                        if (index > -1) {
                            selectedReportTypes.splice(index, 1);
                        }
                    } else {
                        this.classList.add('selected');
                        selectedReportTypes.push(reportType);
                    }
                    
                    console.log('Tipos de relatório selecionados:', selectedReportTypes);
                });
            });
            
            // Configurar data padrão para o mês atual
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            reportDataInicio.value = primeiroDiaMes.toISOString().split('T')[0];
            reportDataFim.value = hoje.toISOString().split('T')[0];
        }
        
        function coletarDadosRelatorio() {
            const dataInicio = reportDataInicio.value ? new Date(reportDataInicio.value) : null;
            const dataFim = reportDataFim.value ? new Date(reportDataFim.value) : null;
            const statusFiltro = reportStatus.value;
            const empresaFiltro = reportEmpresa.value;
            
            // Aplicar filtros aos dados
            let dadosFiltrados = {
                empresas: aplicarFiltrosEmpresas(dataInicio, dataFim, statusFiltro, empresaFiltro),
                departamentos: aplicarFiltrosDepartamentos(dataInicio, dataFim, statusFiltro, empresaFiltro),
                colaboradores: aplicarFiltrosColaboradores(dataInicio, dataFim, statusFiltro, empresaFiltro),
                itens: aplicarFiltrosItens(dataInicio, dataFim, statusFiltro, empresaFiltro),
                solicitacoes: aplicarFiltrosSolicitacoes(dataInicio, dataFim, statusFiltro, empresaFiltro),
                dashboard: gerarDadosDashboard(dataInicio, dataFim, statusFiltro, empresaFiltro)
            };
            
            return dadosFiltrados;
        }
        
        function aplicarFiltrosEmpresas(dataInicio, dataFim, statusFiltro, empresaFiltro) {
            let empresasFiltradas = empresas;
            
            // Filtrar por empresa se especificado
            if (empresaFiltro) {
                empresasFiltradas = empresasFiltradas.filter(e => e.id === empresaFiltro);
            }
            
            // Filtrar por data (baseado nas solicitações da empresa)
            if (dataInicio || dataFim || statusFiltro) {
                empresasFiltradas = empresasFiltradas.map(empresa => {
                    const solicitacoesEmpresa = solicitacoes.filter(s => 
                        (s.empresaId === empresa.id || s.empresa === empresa.nome) &&
                        (!dataInicio || new Date(s.dataSolicitacao) >= dataInicio) &&
                        (!dataFim || new Date(s.dataSolicitacao) <= dataFim) &&
                        (!statusFiltro || s.status === statusFiltro)
                    );
                    
                    return {
                        ...empresa,
                        solicitacoesFiltradas: solicitacoesEmpresa.length
                    };
                });
            }
            
            return empresasFiltradas;
        }
        
        function aplicarFiltrosDepartamentos(dataInicio, dataFim, statusFiltro, empresaFiltro) {
            let departamentosFiltrados = departamentos;
            
            // Filtrar por data (baseado nas solicitações do departamento)
            if (dataInicio || dataFim || statusFiltro) {
                departamentosFiltrados = departamentosFiltrados.map(departamento => {
                    const solicitacoesDepartamento = solicitacoes.filter(s => 
                        (s.departamentoId === departamento.id || s.departamento === departamento.nome) &&
                        (!dataInicio || new Date(s.dataSolicitacao) >= dataInicio) &&
                        (!dataFim || new Date(s.dataSolicitacao) <= dataFim) &&
                        (!statusFiltro || s.status === statusFiltro) &&
                        (!empresaFiltro || s.empresaId === empresaFiltro)
                    );
                    
                    return {
                        ...departamento,
                        solicitacoesFiltradas: solicitacoesDepartamento.length
                    };
                });
            }
            
            return departamentosFiltrados;
        }
        
        function aplicarFiltrosColaboradores(dataInicio, dataFim, statusFiltro, empresaFiltro) {
            let colaboradoresFiltrados = colaboradores;
            
            // Filtrar por empresa
            if (empresaFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => c.empresaId === empresaFiltro);
            }
            
            // Filtrar por data (baseado nas solicitações do colaborador)
            if (dataInicio || dataFim || statusFiltro) {
                colaboradoresFiltrados = colaboradoresFiltrados.map(colaborador => {
                    const solicitacoesColaborador = solicitacoes.filter(s => 
                        s.colaboradorId === colaborador.id &&
                        (!dataInicio || new Date(s.dataSolicitacao) >= dataInicio) &&
                        (!dataFim || new Date(s.dataSolicitacao) <= dataFim) &&
                        (!statusFiltro || s.status === statusFiltro)
                    );
                    
                    return {
                        ...colaborador,
                        solicitacoesFiltradas: solicitacoesColaborador.length
                    };
                });
            }
            
            return colaboradoresFiltrados;
        }
        
        function aplicarFiltrosItens(dataInicio, dataFim, statusFiltro, empresaFiltro) {
            let itensFiltrados = itens;
            
            // Filtrar por data (baseado nas solicitações do item)
            if (dataInicio || dataFim || statusFiltro || empresaFiltro) {
                itensFiltrados = itensFiltrados.map(item => {
                    const solicitacoesItem = solicitacoes.filter(s => {
                        // Verificar se o item está na solicitação
                        const temItem = s.itens && s.itens.some(i => i.itemId === item.id);
                        
                        return temItem &&
                            (!dataInicio || new Date(s.dataSolicitacao) >= dataInicio) &&
                            (!dataFim || new Date(s.dataSolicitacao) <= dataFim) &&
                            (!statusFiltro || s.status === statusFiltro) &&
                            (!empresaFiltro || s.empresaId === empresaFiltro);
                    });
                    
                    return {
                        ...item,
                        solicitacoesFiltradas: solicitacoesItem.length
                    };
                });
            }
            
            return itensFiltrados;
        }
        
        function aplicarFiltrosSolicitacoes(dataInicio, dataFim, statusFiltro, empresaFiltro) {
            let solicitacoesFiltradas = solicitacoes;
            
            // Aplicar filtros
            if (dataInicio) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    new Date(s.dataSolicitacao) >= dataInicio
                );
            }
            
            if (dataFim) {
                const dataFimAjustada = new Date(dataFim);
                dataFimAjustada.setHours(23, 59, 59, 999);
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    new Date(s.dataSolicitacao) <= dataFimAjustada
                );
            }
            
            if (statusFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.status === statusFiltro
                );
            }
            
            if (empresaFiltro) {
                solicitacoesFiltradas = solicitacoesFiltradas.filter(s => 
                    s.empresaId === empresaFiltro
                );
            }
            
            return solicitacoesFiltradas;
        }
        
        function gerarDadosDashboard(dataInicio, dataFim, statusFiltro, empresaFiltro) {
            const empresasFiltradas = aplicarFiltrosEmpresas(dataInicio, dataFim, statusFiltro, empresaFiltro);
            const colaboradoresFiltrados = aplicarFiltrosColaboradores(dataInicio, dataFim, statusFiltro, empresaFiltro);
            const itensFiltrados = aplicarFiltrosItens(dataInicio, dataFim, statusFiltro, empresaFiltro);
            const solicitacoesFiltradas = aplicarFiltrosSolicitacoes(dataInicio, dataFim, statusFiltro, empresaFiltro);
            
            // Calcular estatísticas
            const totalEmpresas = empresasFiltradas.length;
            const totalColaboradores = colaboradoresFiltrados.length;
            const totalItens = itensFiltrados.length;
            const totalSolicitacoes = solicitacoesFiltradas.length;
            
            // Distribuição por status
            const statusDistribuicao = {
                pendente: solicitacoesFiltradas.filter(s => s.status === 'pendente').length,
                realizado: solicitacoesFiltradas.filter(s => s.status === 'realizado').length,
                naoPrecisa: solicitacoesFiltradas.filter(s => s.status === 'nao-precisa').length
            };
            
            // Top 5 itens mais solicitados (com tamanho)
            const itensMaisSolicitados = [];
            const contagemItens = {};
            
            solicitacoesFiltradas.forEach(solicitacao => {
                if (solicitacao.itens && solicitacao.itens.length > 0) {
                    solicitacao.itens.forEach(item => {
                        const chave = `${item.itemId}-${item.tamanho}`;
                        if (!contagemItens[chave]) {
                            contagemItens[chave] = {
                                nome: item.item,
                                tamanho: item.tamanho,
                                quantidade: 0
                            };
                        }
                        contagemItens[chave].quantidade += item.quantidade;
                    });
                }
            });
            
            const itensArray = Object.values(contagemItens);
            itensArray.sort((a, b) => b.quantidade - a.quantidade);
            const itensMaisSolicitadosComTamanho = itensArray.slice(0, 5);
            
            // Top 5 empresas com mais solicitações
            const empresasMaisSolicitacoes = empresasFiltradas
                .map(empresa => ({
                    nome: empresa.nome,
                    totalSolicitacoes: empresa.solicitacoesFiltradas || solicitacoesPorEmpresa[empresa.id] || 0
                }))
                .sort((a, b) => b.totalSolicitacoes - a.totalSolicitacoes)
                .slice(0, 5);
            
            return {
                totalEmpresas,
                totalColaboradores,
                totalItens,
                totalSolicitacoes,
                statusDistribuicao,
                itensMaisSolicitados: itensMaisSolicitadosComTamanho,
                empresasMaisSolicitacoes,
                periodo: {
                    inicio: dataInicio ? dataInicio.toLocaleDateString('pt-BR') : 'Não especificado',
                    fim: dataFim ? dataFim.toLocaleDateString('pt-BR') : 'Não especificado'
                },
                filtrosAplicados: {
                    status: statusFiltro || 'Todos',
                    empresa: empresaFiltro ? empresas.find(e => e.id === empresaFiltro)?.nome || empresaFiltro : 'Todas'
                }
            };
        }
        
        function gerarVisualizacaoRelatorio(dadosRelatorio) {
            if (selectedReportTypes.length === 0) {
                alert('Por favor, selecione pelo menos um tipo de relatório.');
                return;
            }
            
            currentReportData = dadosRelatorio;
            let html = '<div class="report-content">';
            
            // Adicionar cabeçalho do relatório
            const dataGeracao = new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR');
            html += `
                <div class="report-header">
                    <h3>Relatório UniformControl</h3>
                    <p><strong>Data de geração:</strong> ${dataGeracao}</p>
                    <p><strong>Período:</strong> ${dadosRelatorio.dashboard?.periodo.inicio || reportDataInicio.value || 'Não especificado'} até ${dadosRelatorio.dashboard?.periodo.fim || reportDataFim.value || 'Não especificado'}</p>
                    <p><strong>Tipos incluídos:</strong> ${selectedReportTypes.map(t => t.charAt(0).toUpperCase() + t.slice(1)).join(', ')}</p>
                    <hr style="margin: 20px 0;">
                </div>
            `;
            
            // Gerar conteúdo para cada tipo de relatório selecionado
            selectedReportTypes.forEach(tipo => {
                html += `<h4>${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</h4>`;
                
                switch(tipo) {
                    case 'empresas':
                        html += gerarTabelaEmpresas(dadosRelatorio.empresas);
                        break;
                    case 'departamentos':
                        html += gerarTabelaDepartamentos(dadosRelatorio.departamentos);
                        break;
                    case 'colaboradores':
                        html += gerarTabelaColaboradores(dadosRelatorio.colaboradores);
                        break;
                    case 'itens':
                        html += gerarTabelaItens(dadosRelatorio.itens);
                        break;
                    case 'solicitacoes':
                        html += gerarTabelaSolicitacoes(dadosRelatorio.solicitacoes);
                        break;
                    case 'dashboard':
                        html += gerarResumoDashboard(dadosRelatorio.dashboard);
                        break;
                }
                
                html += '<hr style="margin: 20px 0;">';
            });
            
            html += '</div>';
            
            reportPreviewContent.innerHTML = html;
            reportPreviewSection.classList.add('active');
            
            // Scroll para a visualização
            reportPreviewSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function gerarTabelaEmpresas(empresasDados) {
            if (!empresasDados || empresasDados.length === 0) {
                return '<p>Nenhuma empresa encontrada com os filtros aplicados.</p>';
            }
            
            let html = `
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>Nome da Empresa</th>
                            <th>Solicitações</th>
                            <th>Data de Criação</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            empresasDados.forEach(empresa => {
                const dataCriacao = new Date(empresa.criadoEm).toLocaleDateString('pt-BR');
                const totalSolicitacoes = empresa.solicitacoesFiltradas !== undefined ? empresa.solicitacoesFiltradas : solicitacoesPorEmpresa[empresa.id] || 0;
                
                html += `
                    <tr>
                        <td>${empresa.nome}</td>
                        <td>${totalSolicitacoes}</td>
                        <td>${dataCriacao}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 10px;"><strong>Total:</strong> ${empresasDados.length} empresa(s)</p>
            `;
            
            return html;
        }
        
        function gerarTabelaDepartamentos(departamentosDados) {
            if (!departamentosDados || departamentosDados.length === 0) {
                return '<p>Nenhum departamento encontrado com os filtros aplicados.</p>';
            }
            
            let html = `
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>Nome do Departamento</th>
                            <th>Solicitações</th>
                            <th>Data de Criação</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            departamentosDados.forEach(departamento => {
                const dataCriacao = new Date(departamento.criadoEm).toLocaleDateString('pt-BR');
                const totalSolicitacoes = departamento.solicitacoesFiltradas !== undefined ? departamento.solicitacoesFiltradas : solicitacoesPorDepartamento[departamento.id] || 0;
                
                html += `
                    <tr>
                        <td>${departamento.nome}</td>
                        <td>${totalSolicitacoes}</td>
                        <td>${dataCriacao}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 10px;"><strong>Total:</strong> ${departamentosDados.length} departamento(s)</p>
            `;
            
            return html;
        }
        
        function gerarTabelaColaboradores(colaboradoresDados) {
            if (!colaboradoresDados || colaboradoresDados.length === 0) {
                return '<p>Nenhum colaborador encontrado com os filtros aplicados.</p>';
            }
            
            let html = `
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Empresa</th>
                            <th>Departamento</th>
                            <th>Data Admissão</th>
                            <th>Status</th>
                            <th>Solicitações</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            colaboradoresDados.forEach(colaborador => {
                const dataAdmissao = new Date(colaborador.dataAdmissao).toLocaleDateString('pt-BR');
                const totalSolicitacoes = colaborador.solicitacoesFiltradas !== undefined ? colaborador.solicitacoesFiltradas : solicitacoes.filter(s => s.colaboradorId === colaborador.id).length;
                
                html += `
                    <tr>
                        <td>${colaborador.nome}</td>
                        <td>${colaborador.empresa}</td>
                        <td>${colaborador.departamento}</td>
                        <td>${dataAdmissao}</td>
                        <td>${colaborador.status}</td>
                        <td>${totalSolicitacoes}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 10px;"><strong>Total:</strong> ${colaboradoresDados.length} colaborador(es)</p>
            `;
            
            return html;
        }
        
        function gerarTabelaItens(itensDados) {
            if (!itensDados || itensDados.length === 0) {
                return '<p>Nenhum item encontrado com os filtros aplicados.</p>';
            }
            
            let html = `
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>Nome do Item</th>
                            <th>Categoria</th>
                            <th>Tamanhos</th>
                            <th>Solicitações</th>
                            <th>Data de Criação</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            itensDados.forEach(item => {
                const dataCriacao = new Date(item.criadoEm).toLocaleDateString('pt-BR');
                const tamanhos = item.tamanhos && item.tamanhos.length > 0 ? item.tamanhos.join(', ') : 'N/A';
                const totalSolicitacoes = item.solicitacoesFiltradas !== undefined ? item.solicitacoesFiltradas : solicitacoesPorItem[item.id] || 0;
                
                html += `
                    <tr>
                        <td>${item.nome}</td>
                        <td>${item.categoria}</td>
                        <td>${tamanhos}</td>
                        <td>${totalSolicitacoes}</td>
                        <td>${dataCriacao}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 10px;"><strong>Total:</strong> ${itensDados.length} item(ns)</p>
            `;
            
            return html;
        }
        
        function gerarTabelaSolicitacoes(solicitacoesDados) {
            if (!solicitacoesDados || solicitacoesDados.length === 0) {
                return '<p>Nenhuma solicitação encontrada com os filtros aplicados.</p>';
            }
            
            let html = `
                <table class="preview-table">
                    <thead>
                        <tr>
                            <th>Colaborador</th>
                            <th>Empresa</th>
                            <th>Departamento</th>
                            <th>Itens (Tamanho)</th>
                            <th>Data</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            solicitacoesDados.forEach(solicitacao => {
                const dataSolicitacao = new Date(solicitacao.dataSolicitacao).toLocaleDateString('pt-BR');
                const itensResumo = solicitacao.itens && solicitacao.itens.length > 0 
                    ? solicitacao.itens.map(i => `${i.quantidade}x ${i.item} (${i.tamanho})`).join(', ')
                    : 'Nenhum item';
                
                html += `
                    <tr>
                        <td>${solicitacao.colaborador}</td>
                        <td>${solicitacao.empresa}</td>
                        <td>${solicitacao.departamento}</td>
                        <td>${itensResumo}</td>
                        <td>${dataSolicitacao}</td>
                        <td>${solicitacao.status}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <p style="margin-top: 10px;"><strong>Total:</strong> ${solicitacoesDados.length} solicitação(ões)</p>
            `;
            
            return html;
        }
        
        function gerarResumoDashboard(dashboardDados) {
            if (!dashboardDados) {
                return '<p>Nenhum dado de dashboard disponível.</p>';
            }
            
            let html = `
                <div class="dashboard-summary">
                    <h5>Resumo Estatístico</h5>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                        <div style="background-color: #f0f4f8; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.9rem; color: #718096;">Total de Empresas</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.8rem; font-weight: bold; color: #4A6FA5;">${dashboardDados.totalEmpresas}</p>
                        </div>
                        <div style="background-color: #f0f4f8; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.9rem; color: #718096;">Total de Colaboradores</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.8rem; font-weight: bold; color: #FF7E5F;">${dashboardDados.totalColaboradores}</p>
                        </div>
                        <div style="background-color: #f0f4f8; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.9rem; color: #718096;">Total de Itens</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.8rem; font-weight: bold; color: #38A169;">${dashboardDados.totalItens}</p>
                        </div>
                        <div style="background-color: #f0f4f8; padding: 15px; border-radius: 8px;">
                            <p style="margin: 0; font-size: 0.9rem; color: #718096;">Total de Solicitações</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.8rem; font-weight: bold; color: #D69E2E;">${dashboardDados.totalSolicitacoes}</p>
                        </div>
                    </div>
                    
                    <h5 style="margin-top: 25px;">Distribuição por Status</h5>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <div style="flex: 1; background-color: #FEFCBF; padding: 15px; border-radius: 8px; border-left: 4px solid #D69E2E;">
                            <p style="margin: 0; font-size: 0.9rem; color: #744210;">Pendente</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.5rem; font-weight: bold; color: #744210;">${dashboardDados.statusDistribuicao.pendente}</p>
                        </div>
                        <div style="flex: 1; background-color: #C6F6D5; padding: 15px; border-radius: 8px; border-left: 4px solid #38A169;">
                            <p style="margin: 0; font-size: 0.9rem; color: #22543D;">Realizado</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.5rem; font-weight: bold; color: #22543D;">${dashboardDados.statusDistribuicao.realizado}</p>
                        </div>
                        <div style="flex: 1; background-color: #E2E8F0; padding: 15px; border-radius: 8px; border-left: 4px solid #A0AEC0;">
                            <p style="margin: 0; font-size: 0.9rem; color: #4A5568;">Não Precisa</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.5rem; font-weight: bold; color: #4A5568;">${dashboardDados.statusDistribuicao.naoPrecisa}</p>
                        </div>
                    </div>
            `;
            
            if (dashboardDados.itensMaisSolicitados && dashboardDados.itensMaisSolicitados.length > 0) {
                html += `
                    <h5 style="margin-top: 25px;">Top 5 Itens Mais Solicitados (com Tamanho)</h5>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Tamanho</th>
                                <th>Quantidade</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                dashboardDados.itensMaisSolicitados.forEach(item => {
                    html += `
                        <tr>
                            <td>${item.nome}</td>
                            <td>${item.tamanho}</td>
                            <td>${item.quantidade}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            if (dashboardDados.empresasMaisSolicitacoes && dashboardDados.empresasMaisSolicitacoes.length > 0) {
                html += `
                    <h5 style="margin-top: 25px;">Top 5 Empresas com Mais Solicitações</h5>
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Empresa</th>
                                <th>Solicitações</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                dashboardDados.empresasMaisSolicitacoes.forEach(empresa => {
                    html += `
                        <tr>
                            <td>${empresa.nome}</td>
                            <td>${empresa.totalSolicitacoes}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        function exportarParaExcel() {
            if (selectedReportTypes.length === 0) {
                alert('Por favor, selecione pelo menos um tipo de relatório antes de exportar.');
                return;
            }
            
            if (!currentReportData) {
                alert('Por favor, visualize o relatório primeiro antes de exportar.');
                return;
            }
            
            try {
                // Criar uma nova pasta de trabalho
                const wb = XLSX.utils.book_new();
                
                // Adicionar uma planilha para cada tipo de relatório selecionado
                selectedReportTypes.forEach(tipo => {
                    let dados = [];
                    let nomePlanilha = '';
                    
                    switch(tipo) {
                        case 'empresas':
                            dados = prepararDadosExcelEmpresas(currentReportData.empresas);
                            nomePlanilha = 'Empresas';
                            break;
                        case 'departamentos':
                            dados = prepararDadosExcelDepartamentos(currentReportData.departamentos);
                            nomePlanilha = 'Departamentos';
                            break;
                        case 'colaboradores':
                            dados = prepararDadosExcelColaboradores(currentReportData.colaboradores);
                            nomePlanilha = 'Colaboradores';
                            break;
                        case 'itens':
                            dados = prepararDadosExcelItens(currentReportData.itens);
                            nomePlanilha = 'Itens';
                            break;
                        case 'solicitacoes':
                            dados = prepararDadosExcelSolicitacoes(currentReportData.solicitacoes);
                            nomePlanilha = 'Solicitações';
                            break;
                        case 'dashboard':
                            dados = prepararDadosExcelDashboard(currentReportData.dashboard);
                            nomePlanilha = 'Dashboard';
                            break;
                    }
                    
                    if (dados.length > 0) {
                        const ws = XLSX.utils.json_to_sheet(dados);
                        XLSX.utils.book_append_sheet(wb, ws, nomePlanilha);
                    }
                });
                
                // Gerar nome do arquivo com data
                const dataAtual = new Date().toISOString().split('T')[0];
                const nomeArquivo = `relatorio_uniformcontrol_${dataAtual}.xlsx`;
                
                // Exportar arquivo
                XLSX.writeFile(wb, nomeArquivo);
                
                adicionarAtividade('Relatório exportado para Excel com sucesso');
                
            } catch (error) {
                console.error('❌ Erro ao exportar para Excel:', error);
                alert('❌ Erro ao exportar para Excel. Tente novamente.');
            }
        }
        
        function prepararDadosExcelEmpresas(empresasDados) {
            return empresasDados.map(empresa => ({
                'Nome da Empresa': empresa.nome,
                'Solicitações': empresa.solicitacoesFiltradas !== undefined ? empresa.solicitacoesFiltradas : solicitacoesPorEmpresa[empresa.id] || 0,
                'Data de Criação': new Date(empresa.criadoEm).toLocaleDateString('pt-BR')
            }));
        }
        
        function prepararDadosExcelDepartamentos(departamentosDados) {
            return departamentosDados.map(departamento => ({
                'Nome do Departamento': departamento.nome,
                'Solicitações': departamento.solicitacoesFiltradas !== undefined ? departamento.solicitacoesFiltradas : solicitacoesPorDepartamento[departamento.id] || 0,
                'Data de Criação': new Date(departamento.criadoEm).toLocaleDateString('pt-BR')
            }));
        }
        
        function prepararDadosExcelColaboradores(colaboradoresDados) {
            return colaboradoresDados.map(colaborador => ({
                'Nome': colaborador.nome,
                'Empresa': colaborador.empresa,
                'Departamento': colaborador.departamento,
                'Data de Admissão': new Date(colaborador.dataAdmissao).toLocaleDateString('pt-BR'),
                'Status': colaborador.status,
                'Solicitações': colaborador.solicitacoesFiltradas !== undefined ? colaborador.solicitacoesFiltradas : solicitacoes.filter(s => s.colaboradorId === colaborador.id).length
            }));
        }
        
        function prepararDadosExcelItens(itensDados) {
            return itensDados.map(item => ({
                'Nome do Item': item.nome,
                'Categoria': item.categoria,
                'Tamanhos Disponíveis': item.tamanhos && item.tamanhos.length > 0 ? item.tamanhos.join(', ') : 'N/A',
                'Solicitações': item.solicitacoesFiltradas !== undefined ? item.solicitacoesFiltradas : solicitacoesPorItem[item.id] || 0,
                'Data de Criação': new Date(item.criadoEm).toLocaleDateString('pt-BR')
            }));
        }
        
        function prepararDadosExcelSolicitacoes(solicitacoesDados) {
            return solicitacoesDados.map(solicitacao => ({
                'Colaborador': solicitacao.colaborador,
                'Empresa': solicitacao.empresa,
                'Departamento': solicitacao.departamento,
                'Itens Solicitados': solicitacao.itens && solicitacao.itens.length > 0 
                    ? solicitacao.itens.map(i => `${i.quantidade}x ${i.item} (${i.tamanho})`).join('; ')
                    : 'Nenhum item',
                'Data da Solicitação': new Date(solicitacao.dataSolicitacao).toLocaleDateString('pt-BR'),
                'Status': solicitacao.status
            }));
        }
        
        function prepararDadosExcelDashboard(dashboardDados) {
            const dados = [];
            
            // Estatísticas gerais
            dados.push({
                'Categoria': 'Estatísticas Gerais',
                'Valor': '',
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Total de Empresas',
                'Valor': dashboardDados.totalEmpresas,
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Total de Colaboradores',
                'Valor': dashboardDados.totalColaboradores,
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Total de Itens',
                'Valor': dashboardDados.totalItens,
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Total de Solicitações',
                'Valor': dashboardDados.totalSolicitacoes,
                'Detalhes': ''
            });
            
            // Distribuição por status
            dados.push({
                'Categoria': '',
                'Valor': '',
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Distribuição por Status',
                'Valor': '',
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Pendente',
                'Valor': dashboardDados.statusDistribuicao.pendente,
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Realizado',
                'Valor': dashboardDados.statusDistribuicao.realizado,
                'Detalhes': ''
            });
            dados.push({
                'Categoria': 'Não Precisa',
                'Valor': dashboardDados.statusDistribuicao.naoPrecisa,
                'Detalhes': ''
            });
            
            // Itens mais solicitados (com tamanho)
            if (dashboardDados.itensMaisSolicitados && dashboardDados.itensMaisSolicitados.length > 0) {
                dados.push({
                    'Categoria': '',
                    'Valor': '',
                    'Detalhes': ''
                });
                dados.push({
                    'Categoria': 'Top 5 Itens Mais Solicitados (com Tamanho)',
                    'Valor': '',
                    'Detalhes': ''
                });
                
                dashboardDados.itensMaisSolicitados.forEach(item => {
                    dados.push({
                        'Categoria': item.nome,
                        'Valor': item.tamanho,
                        'Detalhes': item.quantidade
                    });
                });
            }
            
            return dados;
        }
        
        function exportarParaPDF() {
            if (selectedReportTypes.length === 0) {
                alert('Por favor, selecione pelo menos um tipo de relatório antes de exportar.');
                return;
            }
            
            if (!currentReportData) {
                alert('Por favor, visualize o relatório primeiro antes de exportar.');
                return;
            }
            
            try {
                // Usar jsPDF para gerar PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Configurações
                const marginLeft = 10;
                const marginTop = 10;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let currentY = marginTop;
                
                // Cabeçalho
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('Relatório UniformControl', pageWidth / 2, currentY, { align: 'center' });
                currentY += 8;
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                const dataGeracao = new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR');
                doc.text(`Data de geração: ${dataGeracao}`, marginLeft, currentY);
                doc.text(`Período: ${reportDataInicio.value || 'Não especificado'} até ${reportDataFim.value || 'Não especificado'}`, pageWidth - marginLeft, currentY, { align: 'right' });
                currentY += 6;
                
                doc.text(`Tipos incluídos: ${selectedReportTypes.map(t => t.charAt(0).toUpperCase() + t.slice(1)).join(', ')}`, marginLeft, currentY);
                currentY += 10;
                
                // Linha divisória
                doc.setDrawColor(200, 200, 200);
                doc.line(marginLeft, currentY, pageWidth - marginLeft, currentY);
                currentY += 5;
                
                // Função para verificar se precisa de nova página
                const checkPageBreak = (neededSpace) => {
                    if (currentY + neededSpace > pageHeight - 20) {
                        doc.addPage();
                        currentY = marginTop;
                        return true;
                    }
                    return false;
                };
                
                // Gerar conteúdo para cada tipo de relatório
                selectedReportTypes.forEach((tipo, index) => {
                    if (index > 0) {
                        currentY += 5;
                    }
                    
                    // Título da seção
                    checkPageBreak(10);
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'bold');
                    doc.text(tipo.charAt(0).toUpperCase() + tipo.slice(1), marginLeft, currentY);
                    currentY += 8;
                    
                    // Conteúdo da seção
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    
                    switch(tipo) {
                        case 'empresas':
                            gerarPDFEmpresas(doc, currentReportData.empresas, marginLeft, currentY);
                            currentY += (currentReportData.empresas.length * 6) + 15;
                            break;
                        case 'departamentos':
                            gerarPDFDepartamentos(doc, currentReportData.departamentos, marginLeft, currentY);
                            currentY += (currentReportData.departamentos.length * 6) + 15;
                            break;
                        case 'colaboradores':
                            gerarPDFColaboradores(doc, currentReportData.colaboradores, marginLeft, currentY);
                            currentY += (currentReportData.colaboradores.length * 6) + 15;
                            break;
                        case 'itens':
                            gerarPDFItens(doc, currentReportData.itens, marginLeft, currentY);
                            currentY += (currentReportData.itens.length * 6) + 15;
                            break;
                        case 'solicitacoes':
                            gerarPDFSolicitacoes(doc, currentReportData.solicitacoes, marginLeft, currentY);
                            currentY += (currentReportData.solicitacoes.length * 6) + 15;
                            break;
                        case 'dashboard':
                            currentY = gerarPDFDashboard(doc, currentReportData.dashboard, marginLeft, currentY);
                            break;
                    }
                    
                    checkPageBreak(20);
                });
                
                // Gerar nome do arquivo com data
                const dataAtual = new Date().toISOString().split('T')[0];
                const nomeArquivo = `relatorio_uniformcontrol_${dataAtual}.pdf`;
                
                // Salvar PDF
                doc.save(nomeArquivo);
                
                adicionarAtividade('Relatório exportado para PDF com sucesso');
                
            } catch (error) {
                console.error('❌ Erro ao exportar para PDF:', error);
                alert('❌ Erro ao exportar para PDF. Tente novamente.');
            }
        }
        
        function gerarPDFEmpresas(doc, empresasDados, startX, startY) {
            let currentY = startY;
            
            if (!empresasDados || empresasDados.length === 0) {
                doc.text('Nenhuma empresa encontrada com os filtros aplicados.', startX, currentY);
                return;
            }
            
            // Cabeçalho da tabela
            doc.setFont('helvetica', 'bold');
            doc.text('Empresa', startX, currentY);
            doc.text('Solicitações', startX + 100, currentY);
            doc.text('Data Criação', startX + 140, currentY);
            currentY += 5;
            
            doc.setDrawColor(200, 200, 200);
            doc.line(startX, currentY, startX + 180, currentY);
            currentY += 2;
            
            // Dados
            doc.setFont('helvetica', 'normal');
            empresasDados.forEach(empresa => {
                const totalSolicitacoes = empresa.solicitacoesFiltradas !== undefined ? empresa.solicitacoesFiltradas : solicitacoesPorEmpresa[empresa.id] || 0;
                const dataCriacao = new Date(empresa.criadoEm).toLocaleDateString('pt-BR');
                
                doc.text(empresa.nome.substring(0, 30), startX, currentY);
                doc.text(totalSolicitacoes.toString(), startX + 100, currentY);
                doc.text(dataCriacao, startX + 140, currentY);
                currentY += 6;
            });
            
            // Total
            doc.setFont('helvetica', 'bold');
            doc.text(`Total: ${empresasDados.length} empresa(s)`, startX, currentY);
        }
        
        function gerarPDFDepartamentos(doc, departamentosDados, startX, startY) {
            let currentY = startY;
            
            if (!departamentosDados || departamentosDados.length === 0) {
                doc.text('Nenhum departamento encontrado com os filtros aplicados.', startX, currentY);
                return;
            }
            
            // Cabeçalho da tabela
            doc.setFont('helvetica', 'bold');
            doc.text('Departamento', startX, currentY);
            doc.text('Solicitações', startX + 100, currentY);
            doc.text('Data Criação', startX + 140, currentY);
            currentY += 5;
            
            doc.setDrawColor(200, 200, 200);
            doc.line(startX, currentY, startX + 180, currentY);
            currentY += 2;
            
            // Dados
            doc.setFont('helvetica', 'normal');
            departamentosDados.forEach(departamento => {
                const totalSolicitacoes = departamento.solicitacoesFiltradas !== undefined ? departamento.solicitacoesFiltradas : solicitacoesPorDepartamento[departamento.id] || 0;
                const dataCriacao = new Date(departamento.criadoEm).toLocaleDateString('pt-BR');
                
                doc.text(departamento.nome.substring(0, 30), startX, currentY);
                doc.text(totalSolicitacoes.toString(), startX + 100, currentY);
                doc.text(dataCriacao, startX + 140, currentY);
                currentY += 6;
            });
            
            // Total
            doc.setFont('helvetica', 'bold');
            doc.text(`Total: ${departamentosDados.length} departamento(s)`, startX, currentY);
        }
        
        function gerarPDFColaboradores(doc, colaboradoresDados, startX, startY) {
            let currentY = startY;
            
            if (!colaboradoresDados || colaboradoresDados.length === 0) {
                doc.text('Nenhum colaborador encontrado com os filtros aplicados.', startX, currentY);
                return;
            }
            
            // Cabeçalho da tabela
            doc.setFont('helvetica', 'bold');
            doc.text('Colaborador', startX, currentY);
            doc.text('Empresa', startX + 50, currentY);
            doc.text('Status', startX + 100, currentY);
            doc.text('Solicitações', startX + 140, currentY);
            currentY += 5;
            
            doc.setDrawColor(200, 200, 200);
            doc.line(startX, currentY, startX + 180, currentY);
            currentY += 2;
            
            // Dados
            doc.setFont('helvetica', 'normal');
            colaboradoresDados.forEach(colaborador => {
                const totalSolicitacoes = colaborador.solicitacoesFiltradas !== undefined ? colaborador.solicitacoesFiltradas : solicitacoes.filter(s => s.colaboradorId === colaborador.id).length;
                
                doc.text(colaborador.nome.substring(0, 20), startX, currentY);
                doc.text(colaborador.empresa.substring(0, 15), startX + 50, currentY);
                doc.text(colaborador.status, startX + 100, currentY);
                doc.text(totalSolicitacoes.toString(), startX + 140, currentY);
                currentY += 6;
            });
            
            // Total
            doc.setFont('helvetica', 'bold');
            doc.text(`Total: ${colaboradoresDados.length} colaborador(es)`, startX, currentY);
        }
        
        function gerarPDFItens(doc, itensDados, startX, startY) {
            let currentY = startY;
            
            if (!itensDados || itensDados.length === 0) {
                doc.text('Nenhum item encontrado com os filtros aplicados.', startX, currentY);
                return;
            }
            
            // Cabeçalho da tabela
            doc.setFont('helvetica', 'bold');
            doc.text('Item', startX, currentY);
            doc.text('Categoria', startX + 60, currentY);
            doc.text('Solicitações', startX + 120, currentY);
            currentY += 5;
            
            doc.setDrawColor(200, 200, 200);
            doc.line(startX, currentY, startX + 180, currentY);
            currentY += 2;
            
            // Dados
            doc.setFont('helvetica', 'normal');
            itensDados.forEach(item => {
                const totalSolicitacoes = item.solicitacoesFiltradas !== undefined ? item.solicitacoesFiltradas : solicitacoesPorItem[item.id] || 0;
                
                doc.text(item.nome.substring(0, 25), startX, currentY);
                doc.text(item.categoria, startX + 60, currentY);
                doc.text(totalSolicitacoes.toString(), startX + 120, currentY);
                currentY += 6;
            });
            
            // Total
            doc.setFont('helvetica', 'bold');
            doc.text(`Total: ${itensDados.length} item(ns)`, startX, currentY);
        }
        
        function gerarPDFSolicitacoes(doc, solicitacoesDados, startX, startY) {
            let currentY = startY;
            
            if (!solicitacoesDados || solicitacoesDados.length === 0) {
                doc.text('Nenhuma solicitação encontrada com os filtros aplicados.', startX, currentY);
                return;
            }
            
            // Cabeçalho da tabela
            doc.setFont('helvetica', 'bold');
            doc.text('Colaborador', startX, currentY);
            doc.text('Empresa', startX + 50, currentY);
            doc.text('Data', startX + 100, currentY);
            doc.text('Status', startX + 140, currentY);
            currentY += 5;
            
            doc.setDrawColor(200, 200, 200);
            doc.line(startX, currentY, startX + 180, currentY);
            currentY += 2;
            
            // Dados
            doc.setFont('helvetica', 'normal');
            solicitacoesDados.forEach(solicitacao => {
                const dataSolicitacao = new Date(solicitacao.dataSolicitacao).toLocaleDateString('pt-BR');
                
                doc.text(solicitacao.colaborador.substring(0, 20), startX, currentY);
                doc.text(solicitacao.empresa.substring(0, 15), startX + 50, currentY);
                doc.text(dataSolicitacao, startX + 100, currentY);
                doc.text(solicitacao.status, startX + 140, currentY);
                currentY += 6;
            });
            
            // Total
            doc.setFont('helvetica', 'bold');
            doc.text(`Total: ${solicitacoesDados.length} solicitação(ões)`, startX, currentY);
        }
        
        function gerarPDFDashboard(doc, dashboardDados, startX, startY) {
            let currentY = startY;
            
            if (!dashboardDados) {
                doc.text('Nenhum dado de dashboard disponível.', startX, currentY);
                return currentY + 10;
            }
            
            // Estatísticas gerais
            doc.setFont('helvetica', 'bold');
            doc.text('Estatísticas Gerais', startX, currentY);
            currentY += 6;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`Total de Empresas: ${dashboardDados.totalEmpresas}`, startX, currentY);
            currentY += 5;
            doc.text(`Total de Colaboradores: ${dashboardDados.totalColaboradores}`, startX, currentY);
            currentY += 5;
            doc.text(`Total de Itens: ${dashboardDados.totalItens}`, startX, currentY);
            currentY += 5;
            doc.text(`Total de Solicitações: ${dashboardDados.totalSolicitacoes}`, startX, currentY);
            currentY += 8;
            
            // Distribuição por status
            doc.setFont('helvetica', 'bold');
            doc.text('Distribuição por Status', startX, currentY);
            currentY += 6;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`Pendente: ${dashboardDados.statusDistribuicao.pendente}`, startX, currentY);
            currentY += 5;
            doc.text(`Realizado: ${dashboardDados.statusDistribuicao.realizado}`, startX, currentY);
            currentY += 5;
            doc.text(`Não Precisa: ${dashboardDados.statusDistribuicao.naoPrecisa}`, startX, currentY);
            currentY += 8;
            
            // Itens mais solicitados (com tamanho)
            if (dashboardDados.itensMaisSolicitados && dashboardDados.itensMaisSolicitados.length > 0) {
                doc.setFont('helvetica', 'bold');
                doc.text('Top 5 Itens Mais Solicitados (com Tamanho)', startX, currentY);
                currentY += 6;
                
                doc.setFont('helvetica', 'normal');
                dashboardDados.itensMaisSolicitados.forEach(item => {
                    doc.text(`${item.nome} (${item.tamanho}): ${item.quantidade}`, startX, currentY);
                    currentY += 5;
                });
            }
            
            return currentY;
        }

        // Menu toggle para mobile
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            sidebarOverlay.classList.toggle('active');
        });

        // Fechar sidebar ao clicar no overlay
        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
        });

        // Event Listeners para a aba Empresa
        btnAddEmpresa.addEventListener('click', abrirModalEmpresa);
        btnAddDepartamento.addEventListener('click', abrirModalDepartamento);
        
        closeModalEmpresa.addEventListener('click', fecharModalEmpresa);
        closeModalDepartamento.addEventListener('click', fecharModalDepartamento);
        closeModalColaborador.addEventListener('click', fecharModalColaborador);
        closeModalItem.addEventListener('click', fecharModalItem);
        closeModalSolicitacao.addEventListener('click', fecharModalSolicitacao);
        
        cancelEmpresa.addEventListener('click', fecharModalEmpresa);
        cancelDepartamento.addEventListener('click', fecharModalDepartamento);
        cancelColaborador.addEventListener('click', fecharModalColaborador);
        cancelItem.addEventListener('click', fecharModalItem);
        cancelSolicitacao.addEventListener('click', fecharModalSolicitacao);
        
        filterEmpresa.addEventListener('input', filtrarDados);
        filterDepartamento.addEventListener('input', filtrarDados);
        
        // Event Listeners para a aba Colaboradores
        btnAddColaborador.addEventListener('click', abrirModalColaborador);
        
        filterNomeColaborador.addEventListener('input', filtrarColaboradores);
        filterStatusColaborador.addEventListener('change', filtrarColaboradores);
        filterEmpresaColaborador.addEventListener('change', filtrarColaboradores);
        filterDepartamentoColaborador.addEventListener('change', filtrarColaboradores);

        // Event Listeners para a aba Itens
        btnAddItem.addEventListener('click', abrirModalItem);
        
        filterNomeItem.addEventListener('input', filtrarItens);
        filterCategoriaItem.addEventListener('change', filtrarItens);

        // Event Listeners para a aba Solicitações
        btnAddSolicitacao.addEventListener('click', abrirModalSolicitacao);
        addItemSolicitacaoBtn.addEventListener('click', adicionarItemSolicitacao);
        
        filterColaboradorSolicitacao.addEventListener('input', filtrarSolicitacoes);
        filterEmpresaSolicitacao.addEventListener('change', filtrarSolicitacoes);
        filterDepartamentoSolicitacao.addEventListener('change', filtrarSolicitacoes);
        filterItemSolicitacao.addEventListener('input', filtrarSolicitacoes);
        filterStatusSolicitacao.addEventListener('change', filtrarSolicitacoes);
        filterDataInicioSolicitacao.addEventListener('change', filtrarSolicitacoes);
        filterDataFimSolicitacao.addEventListener('change', filtrarSolicitacoes);
        
        colaboradorSolicitacaoSelect.addEventListener('change', atualizarInfoColaborador);

        // Event Listeners para Dashboard
        btnAplicarFiltrosDashboard.addEventListener('click', function() {
            atualizarGraficosDashboard();
            adicionarAtividade('Filtros do dashboard aplicados');
        });

        // Event listener para o filtro de tempo médio
        tempoMedioFiltro.addEventListener('change', calcularTempoMedioTroca);

        // Event Listeners para a aba Relatórios
        btnPreviewReport.addEventListener('click', function() {
            const dadosRelatorio = coletarDadosRelatorio();
            gerarVisualizacaoRelatorio(dadosRelatorio);
        });
        
        btnExportExcel.addEventListener('click', exportarParaExcel);
        btnExportPDF.addEventListener('click', exportarParaPDF);
        btnExportPreviewExcel.addEventListener('click', exportarParaExcel);
        btnExportPreviewPDF.addEventListener('click', exportarParaPDF);

        // Formulário de colaborador
        formColaborador.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const colaboradorData = {
                nome: nomeColaboradorInput.value.trim(),
                empresaId: empresaColaboradorSelect.value,
                departamentoId: departamentoColaboradorSelect.value,
                dataAdmissao: dataAdmissaoColaboradorInput.value,
                status: statusColaboradorSelect.value
            };
            
            if (!colaboradorData.nome || !colaboradorData.empresaId || !colaboradorData.departamentoId) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            if (editandoColaboradorId) {
                try {
                    if (!db) throw new Error("Firebase não inicializado");
                    
                    const empresaSelecionada = empresas.find(e => e.id === colaboradorData.empresaId);
                    const departamentoSelecionado = departamentos.find(d => d.id === colaboradorData.departamentoId);
                    
                    // CORREÇÃO: Criar data sem ajuste de fuso horário
                    const dataAdmissao = new Date(colaboradorData.dataAdmissao);
                    // Adicionar um dia para compensar o fuso horário
                    dataAdmissao.setDate(dataAdmissao.getDate() + 1);
                    
                    await db.collection('colaboradores').doc(editandoColaboradorId).update({
                        nome: colaboradorData.nome,
                        empresaId: colaboradorData.empresaId,
                        empresa: empresaSelecionada ? empresaSelecionada.nome : '',
                        departamentoId: colaboradorData.departamentoId,
                        departamento: departamentoSelecionado ? departamentoSelecionado.nome : '',
                        dataAdmissao: firebase.firestore.Timestamp.fromDate(dataAdmissao),
                        status: colaboradorData.status
                    });
                    
                    adicionarAtividade(`Colaborador "${colaboradorData.nome}" atualizado com sucesso`);
                    fecharModalColaborador();
                } catch (error) {
                    console.error('❌ Erro ao atualizar colaborador:', error);
                    alert('❌ Erro ao atualizar colaborador. Tente novamente.');
                }
            } else {
                console.log('💾 Salvando colaborador...');
                const success = await adicionarColaborador(colaboradorData);
                if (success) {
                    fecharModalColaborador();
                }
            }
        });

        // Formulário de item
        formItem.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const itemData = {
                nome: nomeItemInput.value.trim(),
                categoria: categoriaItemSelect.value,
                tamanhos: tamanhosItemTextarea.value
            };
            
            if (!itemData.nome) {
                alert('Por favor, preencha o nome do item.');
                return;
            }
            
            if (editandoItemId) {
                try {
                    if (!db) throw new Error("Firebase não inicializado");
                    
                    // Processar tamanhos
                    let tamanhosArray = [];
                    if (itemData.tamanhos && itemData.tamanhos.trim() !== '') {
                        tamanhosArray = itemData.tamanhos.split(',')
                            .map(t => t.trim())
                            .filter(t => t !== '');
                    }
                    
                    await db.collection('itens').doc(editandoItemId).update({
                        nome: itemData.nome,
                        categoria: itemData.categoria,
                        tamanhos: tamanhosArray
                    });
                    
                    adicionarAtividade(`Item "${itemData.nome}" atualizado com sucesso`);
                    fecharModalItem();
                } catch (error) {
                    console.error('❌ Erro ao atualizar item:', error);
                    alert('❌ Erro ao atualizar item. Tente novamente.');
                }
            } else {
                console.log('💾 Salvando item...');
                const success = await adicionarItem(itemData);
                if (success) {
                    fecharModalItem();
                }
            }
        });

        // Formulário de solicitação
        formSolicitacao.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validar colaborador
            if (!colaboradorSolicitacaoSelect.value) {
                alert('Por favor, selecione um colaborador.');
                return;
            }
            
            // Coletar dados dos itens
            const itensData = [];
            const itemDivs = itensSolicitacaoContainer.querySelectorAll('.item-solicitacao');
            let hasErrors = false;
            
            itemDivs.forEach((itemDiv, index) => {
                const itemSelect = itemDiv.querySelector('.item-select');
                const tamanhoSelect = itemDiv.querySelector('.tamanho-select');
                const quantidadeInput = itemDiv.querySelector('.quantidade-input');
                
                // Validar cada item
                if (!itemSelect.value) {
                    alert(`Por favor, selecione um item para o Item #${index + 1}.`);
                    itemSelect.focus();
                    hasErrors = true;
                    return;
                }
                
                if (!tamanhoSelect.value) {
                    alert(`Por favor, selecione um tamanho para o Item #${index + 1}.`);
                    tamanhoSelect.focus();
                    hasErrors = true;
                    return;
                }
                
                if (!quantidadeInput.value || parseInt(quantidadeInput.value) < 1) {
                    alert(`Por favor, insira uma quantidade válida para o Item #${index + 1}.`);
                    quantidadeInput.focus();
                    hasErrors = true;
                    return;
                }
                
                const itemCompleto = itens.find(i => i.id === itemSelect.value);
                itensData.push({
                    itemId: itemSelect.value,
                    item: itemCompleto ? itemCompleto.nome : '',
                    tamanho: tamanhoSelect.value,
                    quantidade: parseInt(quantidadeInput.value)
                });
            });
            
            if (hasErrors) return;
            
            if (itensData.length === 0) {
                alert('Por favor, adicione pelo menos um item à solicitação.');
                return;
            }
            
            const solicitacaoData = {
                colaboradorId: colaboradorSolicitacaoSelect.value,
                itens: itensData,
                dataSolicitacao: dataSolicitacaoInput.value,
                status: statusSolicitacaoSelect.value
            };
            
            if (editandoSolicitacaoId) {
                try {
                    if (!db) throw new Error("Firebase não inicializado");
                    
                    const colaboradorSelecionado = colaboradores.find(c => c.id === solicitacaoData.colaboradorId);
                    
                    // CORREÇÃO: Criar data sem ajuste de fuso horário
                    const dataSolicitacao = new Date(solicitacaoData.dataSolicitacao);
                    // Adicionar um dia para compensar o fuso horário
                    dataSolicitacao.setDate(dataSolicitacao.getDate() + 1);
                    
                    await db.collection('solicitacoes').doc(editandoSolicitacaoId).update({
                        colaboradorId: solicitacaoData.colaboradorId,
                        colaborador: colaboradorSelecionado ? colaboradorSelecionado.nome : '',
                        empresaId: colaboradorSelecionado ? colaboradorSelecionado.empresaId : '',
                        empresa: colaboradorSelecionado ? colaboradorSelecionado.empresa : '',
                        departamentoId: colaboradorSelecionado ? colaboradorSelecionado.departamentoId : '',
                        departamento: colaboradorSelecionado ? colaboradorSelecionado.departamento : '',
                        itens: solicitacaoData.itens,
                        dataSolicitacao: firebase.firestore.Timestamp.fromDate(dataSolicitacao),
                        status: solicitacaoData.status
                    });
                    
                    adicionarAtividade(`Solicitação atualizada com sucesso`);
                    fecharModalSolicitacao();
                } catch (error) {
                    console.error('❌ Erro ao atualizar solicitação:', error);
                    alert('❌ Erro ao atualizar solicitação. Tente novamente.');
                }
            } else {
                console.log('💾 Salvando solicitação...');
                const success = await adicionarSolicitacao(solicitacaoData);
                if (success) {
                    fecharModalSolicitacao();
                }
            }
        });

        // Navegação entre páginas
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const pageId = this.getAttribute('data-page');
                console.log('🔗 Clicou na página:', pageId);
                
                mostrarPagina(pageId);
                
                // Inicializar relatórios se for a página de relatórios
                if (pageId === 'relatorios') {
                    inicializarRelatorios();
                }
                
                if (window.innerWidth <= 1100) {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                }
            });
        });

        // Fechar sidebar ao redimensionar a janela para desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth > 1100) {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
            }
        });

        // Inicializar o sistema
        function inicializarSistema() {
            console.log("🚀 Inicializando sistema...");
            
            try {
                console.log("🔥 Inicializando Firebase...");
                const firebaseInicializado = inicializarFirebase();
                
                if (firebaseInicializado) {
                    console.log("✅ Firebase inicializado com sucesso");
                    carregarDadosFirebase();
                } else {
                    console.log("⚠️ Firebase não inicializado, usando modo offline");
                    adicionarAtividade("⚠️ Modo offline - Conectando localmente");
                    usarDadosMock();
                }
                
                mostrarPagina('dashboard');
                
                console.log("✅ Sistema inicializado com sucesso");
                
            } catch (error) {
                console.error('❌ Erro ao inicializar sistema:', error);
                alert('❌ Erro ao inicializar o sistema. Por favor, recarregue a página.');
                
                usarDadosMock();
                mostrarPagina('dashboard');
            }
        }

        // Inicializar quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log("📄 DOM carregado");
            inicializarSistema();
        });
        
        // Tornar funções globais para os botões de ação
        window.editarEmpresa = editarEmpresa;
        window.excluirEmpresa = excluirEmpresa;
        window.editarDepartamento = editarDepartamento;
        window.excluirDepartamento = excluirDepartamento;
        window.editarColaborador = editarColaborador;
        window.excluirColaborador = excluirColaborador;
        window.editarItem = editarItem;
        window.excluirItem = excluirItem;
        window.editarSolicitacao = editarSolicitacao;
        window.excluirSolicitacao = excluirSolicitacao;
        window.atualizarStatusSolicitacao = atualizarStatusSolicitacao;
        window.removerItemSolicitacao = removerItemSolicitacao;
        window.adicionarItemSolicitacao = adicionarItemSolicitacao;
        window.atualizarTamanhosSelect = atualizarTamanhosSelect;
        
        // Adicionar mensagem de debug no console
        console.log("👋 Sistema UniformControl carregado!");
        console.log("📌 Para testar, clique em 'Dashboard' para visualizar os gráficos");
        console.log("📌 Use os filtros no dashboard para analisar dados específicos");
        console.log("📌 Na aba Relatórios, selecione os tipos de dados e exporte para PDF ou Excel");
        console.log("📌 Os relatórios agora incluem informações de tamanho dos itens solicitados");
        console.log("📌 Tempo médio de troca implementado com filtro de dias/meses/anos");
    </script>
</body>
</html>